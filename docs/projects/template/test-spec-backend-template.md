# バックエンドテスト方針書

## 案件情報

| 項目 | 内容 |
|------|------|
| 案件名 | <!-- 案件名を記載 --> |
| 案件ID | <!-- YYYYMM_案件名 --> |
| 作成日 | <!-- YYYY-MM-DD --> |
| 作成者 | <!-- 担当者名 --> |
| 関連詳細設計書 | [detail-design-api.md](./detail-design-api.md), [detail-design-logic.md](./detail-design-logic.md) |

---

## 1. テスト概要

### 1.1 テスト対象

<!-- この案件で追加・変更するバックエンドのテスト対象 -->

| 対象 | 変更種別 | 概要 |
|------|----------|------|
| <!-- クラス名/機能名 --> | 新規/変更 | <!-- 概要 --> |

### 1.2 テスト方針

<!-- テストの方針・アプローチ -->

### 1.3 テスト戦略

| テストレベル | 対象 | 責務 | 実行タイミング |
|---------|------|------|---------------|
| 単体テスト | Mapper層 | SQL正常動作確認 | 開発中 |
| 統合テスト | Service + Mapper + DB | ビジネスロジック確認 | 開発中 |
| APIテスト | Controller + 全層 | REST API動作確認 | 統合後 |

---

## 2. 単体テスト（Mapper層）

### 2.1 EntityMapperTest

**テスト対象**: `com.example.xxx.mapper.EntityMapper`

#### MT-XXX-001: selectById - 正常系

| 項目 | 内容 |
|------|------|
| テストケースID | MT-XXX-001 |
| テスト観点 | <!-- 何を確認するか --> |
| 分類 | 正常系 |
| 前提条件 | <!-- テストデータの状態 --> |
| 入力値 | <!-- パラメータ --> |
| 期待結果 | <!-- 期待する取得結果 --> |
| 確認方法 | <!-- アサーション内容 --> |

#### MT-XXX-002: insert - 正常系

| 項目 | 内容 |
|------|------|
| テストケースID | MT-XXX-002 |
| テスト観点 | <!-- 何を確認するか --> |
| 分類 | 正常系 |
| 前提条件 | <!-- テストデータの状態 --> |
| 入力値 | <!-- 挿入データ --> |
| 期待結果 | <!-- 期待する挿入結果 --> |
| 確認方法 | <!-- アサーション内容 --> |

#### MT-XXX-B001: selectById - 境界値

| 項目 | 内容 |
|------|------|
| テストケースID | MT-XXX-B001 |
| テスト観点 | <!-- 何を確認するか --> |
| 分類 | 境界値 |
| 前提条件 | <!-- テストデータの状態 --> |
| 入力値 | <!-- 境界値データ --> |
| 期待結果 | <!-- 期待する結果 --> |
| 確認方法 | <!-- アサーション内容 --> |

---

## 3. 統合テスト（Service層）

### 3.1 EntityServiceTest

**テスト対象**: `com.example.xxx.service.EntityService`

#### ST-XXX-001: メソッド名 - 正常系

| 項目 | 内容 |
|------|------|
| テストケースID | ST-XXX-001 |
| テスト観点 | <!-- 何を確認するか --> |
| 分類 | 正常系 |
| 前提条件 | <!-- DB状態、依存サービス状態 --> |
| 入力値 | <!-- 入力データ --> |
| 期待結果 | <!-- 期待する出力・状態変更 --> |
| 確認方法 | <!-- アサーション内容 --> |

#### ST-XXX-002: メソッド名 - 異常系

| 項目 | 内容 |
|------|------|
| テストケースID | ST-XXX-002 |
| テスト観点 | <!-- 何を確認するか --> |
| 分類 | 異常系 |
| 前提条件 | <!-- DB状態、依存サービス状態 --> |
| 入力値 | <!-- 入力データ --> |
| 期待結果 | <!-- 期待する例外・エラー --> |
| 確認方法 | <!-- アサーション内容 --> |

#### ST-XXX-X001: メソッド名 - 例外

| 項目 | 内容 |
|------|------|
| テストケースID | ST-XXX-X001 |
| テスト観点 | <!-- 何を確認するか --> |
| 分類 | 例外 |
| 前提条件 | <!-- 例外発生条件 --> |
| 入力値 | <!-- 入力データ --> |
| 期待結果 | <!-- 期待する例外 --> |
| 確認方法 | `assertThatThrownBy(...).isInstanceOf(...)` |

---

## 4. APIテスト（Controller層）

### 4.1 EntityControllerTest

**テスト対象**: `com.example.xxx.controller.EntityController`

#### CT-XXX-001: POST /api/entities - 正常系

| 項目 | 内容 |
|------|------|
| テストケースID | CT-XXX-001 |
| テスト観点 | <!-- 何を確認するか --> |
| エンドポイント | `POST /api/v1/entities` |
| 前提条件 | <!-- DB状態、認証状態など --> |
| リクエスト | <!-- リクエストボディ --> |
| 期待結果 | ステータス: 201, レスポンス: <!-- 期待値 --> |

#### CT-XXX-002: GET /api/entities/{id} - 正常系

| 項目 | 内容 |
|------|------|
| テストケースID | CT-XXX-002 |
| テスト観点 | <!-- 何を確認するか --> |
| エンドポイント | `GET /api/v1/entities/{id}` |
| 前提条件 | <!-- DB状態など --> |
| パスパラメータ | id: <!-- 値 --> |
| 期待結果 | ステータス: 200, レスポンス: <!-- 期待値 --> |

#### CT-XXX-E001: POST /api/entities - バリデーションエラー

| 項目 | 内容 |
|------|------|
| テストケースID | CT-XXX-E001 |
| テスト観点 | <!-- 何を確認するか --> |
| 分類 | 異常系 |
| エンドポイント | `POST /api/v1/entities` |
| リクエスト | <!-- 不正なリクエストボディ --> |
| 期待結果 | ステータス: 400 |

#### CT-XXX-E002: GET /api/entities/{id} - 存在しないID

| 項目 | 内容 |
|------|------|
| テストケースID | CT-XXX-E002 |
| テスト観点 | <!-- 何を確認するか --> |
| 分類 | 異常系 |
| エンドポイント | `GET /api/v1/entities/{id}` |
| パスパラメータ | id: 999（存在しないID） |
| 期待結果 | ステータス: 404 |

---

## 5. テストケース一覧

| ID | 対象 | テスト観点 | 分類 | 優先度 | ステータス |
|----|------|-----------|------|--------|-----------|
| MT-XXX-001 | EntityMapper.selectById | <!-- 観点 --> | 正常系 | 高 | 未実施 |
| MT-XXX-002 | EntityMapper.insert | <!-- 観点 --> | 正常系 | 高 | 未実施 |
| MT-XXX-B001 | EntityMapper.selectById | <!-- 観点 --> | 境界値 | 中 | 未実施 |
| ST-XXX-001 | EntityService.method | <!-- 観点 --> | 正常系 | 高 | 未実施 |
| ST-XXX-002 | EntityService.method | <!-- 観点 --> | 異常系 | 高 | 未実施 |
| ST-XXX-X001 | EntityService.method | <!-- 観点 --> | 例外 | 中 | 未実施 |
| CT-XXX-001 | POST /api/entities | <!-- 観点 --> | 正常系 | 高 | 未実施 |
| CT-XXX-002 | GET /api/entities/{id} | <!-- 観点 --> | 正常系 | 高 | 未実施 |
| CT-XXX-E001 | POST /api/entities | <!-- 観点 --> | 異常系 | 高 | 未実施 |
| CT-XXX-E002 | GET /api/entities/{id} | <!-- 観点 --> | 異常系 | 中 | 未実施 |

---

## 6. テストデータ

### 6.1 テストデータ一覧

| データID | 用途 | 内容 |
|---------|------|------|
| BTD-001 | 正常系テスト用 | <!-- データ内容 --> |
| BTD-002 | 異常系テスト用 | <!-- データ内容 --> |
| BTD-003 | 境界値テスト用 | <!-- データ内容 --> |

### 6.2 SQL初期化スクリプト

```sql
-- テストデータ投入
-- INSERT INTO xxx (columns) VALUES (values);
```

---

## 7. テスト環境

### 7.1 必要な環境

- JUnit 5
- Spring Boot Test
- MyBatis Test
- H2 インメモリデータベース
- AssertJ
- Mockito

### 7.2 テスト用アノテーション

| レイヤー | アノテーション |
|---------|---------------|
| Mapper層 | `@MybatisTest`, `@AutoConfigureTestDatabase(replace = Replace.NONE)` |
| Service層 | `@SpringBootTest`, `@Transactional` |
| Controller層 | `@SpringBootTest`, `@AutoConfigureMockMvc`, `@Transactional` |

### 7.3 モック・スタブ

| 対象 | モック/スタブ | 設定内容 |
|------|-------------|---------|
| <!-- 外部サービス名 --> | Mock | <!-- 返却値など --> |

---

## 改版履歴

| 版数 | 日付 | 変更内容 | 変更者 |
|------|------|----------|--------|
| 1.0 | YYYY-MM-DD | 初版作成 | <!-- 担当者名 --> |
