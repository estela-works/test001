# E2Eテスト仕様書

## 案件情報

| 項目 | 内容 |
|------|------|
| 案件名 | ToDoチケット詳細モーダル＋コメント機能 |
| 案件ID | 20251225_チケット詳細コメント機能 |
| 作成日 | 2025-12-25 |
| 作成者 | システム管理者 |
| 関連設計書 | [requirements.md](./requirements.md), [basic-design-frontend.md](./basic-design-frontend.md), [basic-design-backend.md](./basic-design-backend.md) |

---

## 1. テスト概要

### 1.1 E2Eテストの目的

エンドユーザーの視点から、ブラウザ上で実際にアプリケーションを操作し、以下を検証する：

1. **ユーザーストーリーの達成**: 要件定義書で定義されたユーザーストーリー（US-001〜US-006）が実際に達成できるか
2. **エンドツーエンドのフロー**: フロントエンド→API→データベース→レスポンス→画面更新の一連の流れが正常に動作するか
3. **実環境での動作確認**: 実際のブラウザ上で期待通りの挙動をするか

### 1.2 テスト対象範囲

| 対象 | 範囲 |
|------|------|
| 画面 | todos.html（チケット一覧＋詳細モーダル） |
| 機能 | チケット詳細モーダル表示、コメントCRUD操作 |
| フロー | チケットクリック→モーダル表示→コメント投稿→削除→モーダル閉じる |
| データ | H2データベース（テストデータを事前投入） |

### 1.3 テスト環境

| 項目 | 内容 |
|------|------|
| E2Eフレームワーク | Playwright |
| ブラウザ | Chromium, Firefox, WebKit |
| バックエンド | Spring Boot (localhost:8080) |
| データベース | H2 Database (テストモード) |
| テストデータ | 各テストケース実行前にセットアップ |

---

## 2. ユーザーストーリーベーステスト

### US-001: チケット詳細モーダル表示

#### E2E-US001-001: チケットをクリックして詳細モーダルを表示する

| 項目 | 内容 |
|------|------|
| テストケースID | E2E-US001-001 |
| ユーザーストーリー | US-001: チケット担当者として、チケットをクリックして詳細をモーダルで表示したい |
| 優先度 | 高 |
| 前提条件 | - アプリケーションが起動している<br>- TODOテーブルにID=1のチケットが存在する（タイトル: "テストタスク", 説明: "テスト用の説明"） |
| テスト手順 | 1. ブラウザで http://localhost:8080/todos.html にアクセス<br>2. チケット一覧に「テストタスク」が表示されることを確認<br>3. 「テストタスク」チケットをクリック |
| 期待結果 | - モーダルが表示される<br>- モーダルヘッダーに「チケット詳細」と表示される<br>- モーダル内に「テストタスク」のタイトルが表示される<br>- モーダル内に「テスト用の説明」が表示される<br>- ステータスバッジ（「未完了」または「完了」）が表示される |
| 検証方法 | `await expect(page.locator('.modal-overlay')).toBeVisible()`<br>`await expect(page.locator('.modal-header')).toContainText('チケット詳細')`<br>`await expect(page.locator('.title')).toContainText('テストタスク')` |

#### E2E-US001-002: モーダルを閉じるボタンで閉じる

| 項目 | 内容 |
|------|------|
| テストケースID | E2E-US001-002 |
| ユーザーストーリー | US-001 |
| 優先度 | 高 |
| 前提条件 | - モーダルが開いている状態（E2E-US001-001の続き） |
| テスト手順 | 1. モーダル右上の「×」ボタンをクリック |
| 期待結果 | - モーダルが閉じる<br>- チケット一覧画面に戻る |
| 検証方法 | `await expect(page.locator('.modal-overlay')).not.toBeVisible()` |

#### E2E-US001-003: Escキーでモーダルを閉じる

| 項目 | 内容 |
|------|------|
| テストケースID | E2E-US001-003 |
| ユーザーストーリー | US-001 |
| 優先度 | 中 |
| 前提条件 | - モーダルが開いている状態 |
| テスト手順 | 1. キーボードで Esc キーを押下 |
| 期待結果 | - モーダルが閉じる |
| 検証方法 | `await page.keyboard.press('Escape')`<br>`await expect(page.locator('.modal-overlay')).not.toBeVisible()` |

#### E2E-US001-004: オーバーレイクリックでモーダルを閉じる

| 項目 | 内容 |
|------|------|
| テストケースID | E2E-US001-004 |
| ユーザーストーリー | US-001 |
| 優先度 | 中 |
| 前提条件 | - モーダルが開いている状態 |
| テスト手順 | 1. モーダル外（オーバーレイ部分）をクリック |
| 期待結果 | - モーダルが閉じる |
| 検証方法 | `await page.locator('.modal-overlay').click({ position: { x: 10, y: 10 } })`<br>`await expect(page.locator('.modal-overlay')).not.toBeVisible()` |

---

### US-002: コメント追加機能

#### E2E-US002-001: コメントを投稿する

| 項目 | 内容 |
|------|------|
| テストケースID | E2E-US002-001 |
| ユーザーストーリー | US-002: チームメンバーとして、チケットに進捗報告や質問をコメントとして追加したい |
| 優先度 | 高 |
| 前提条件 | - モーダルが開いている状態<br>- USERテーブルにID=1のユーザー（名前: "テストユーザー"）が存在する<br>- チケットID=1にコメントが0件 |
| テスト手順 | 1. モーダル内のコメントセクションを確認<br>2. 「コメント (0件)」と表示されていることを確認<br>3. テキストエリアに「進捗報告: 50%完了しました」と入力<br>4. 投稿者ドロップダウンで「テストユーザー」を選択<br>5. 「投稿」ボタンをクリック |
| 期待結果 | - コメントが投稿される<br>- 「コメント (1件)」に件数が更新される<br>- コメント一覧に新しいコメントが表示される<br>- コメント内容「進捗報告: 50%完了しました」が表示される<br>- 投稿者「テストユーザー」が表示される<br>- 投稿日時（相対時間）が表示される<br>- テキストエリアとドロップダウンがクリアされる |
| 検証方法 | `await expect(page.locator('.comment-section h3')).toContainText('コメント (1件)')`<br>`await expect(page.locator('.comment-content')).toContainText('進捗報告: 50%完了しました')`<br>`await expect(page.locator('.author')).toContainText('テストユーザー')` |

#### E2E-US002-002: 連続して複数のコメントを投稿する

| 項目 | 内容 |
|------|------|
| テストケースID | E2E-US002-002 |
| ユーザーストーリー | US-002 |
| 優先度 | 中 |
| 前提条件 | - E2E-US002-001の続き（1件コメントが既に存在） |
| テスト手順 | 1. テキストエリアに「質問: 納期は変更ありませんか？」と入力<br>2. 投稿者ドロップダウンで「テストユーザー」を選択<br>3. 「投稿」ボタンをクリック |
| 期待結果 | - コメントが投稿される<br>- 「コメント (2件)」に件数が更新される<br>- 新しいコメントが一覧の先頭に表示される（新しい順） |
| 検証方法 | `await expect(page.locator('.comment-section h3')).toContainText('コメント (2件)')`<br>`await expect(page.locator('.comment-item').first()).toContainText('質問: 納期は変更ありませんか？')` |

#### E2E-US002-003: コメント投稿時のバリデーション（空コンテンツ）

| 項目 | 内容 |
|------|------|
| テストケースID | E2E-US002-003 |
| ユーザーストーリー | US-002 |
| 優先度 | 高 |
| 前提条件 | - モーダルが開いている状態 |
| テスト手順 | 1. テキストエリアを空のまま<br>2. 投稿者ドロップダウンで「テストユーザー」を選択<br>3. 「投稿」ボタンをクリック |
| 期待結果 | - エラーメッセージ「コメントを入力してください（最大2000文字）」が表示される<br>- コメントが投稿されない（件数が増えない） |
| 検証方法 | `await expect(page.locator('.error-message')).toContainText('コメントを入力してください')` |

#### E2E-US002-004: コメント投稿時のバリデーション（投稿者未選択）

| 項目 | 内容 |
|------|------|
| テストケースID | E2E-US002-004 |
| ユーザーストーリー | US-002 |
| 優先度 | 高 |
| 前提条件 | - モーダルが開いている状態 |
| テスト手順 | 1. テキストエリアに「テストコメント」と入力<br>2. 投稿者ドロップダウンを「投稿者を選択してください」のまま<br>3. 「投稿」ボタンをクリック |
| 期待結果 | - エラーメッセージ「投稿者を選択してください」が表示される<br>- コメントが投稿されない |
| 検証方法 | `await expect(page.locator('.error-message')).toContainText('投稿者を選択してください')` |

#### E2E-US002-005: 文字数カウント表示

| 項目 | 内容 |
|------|------|
| テストケースID | E2E-US002-005 |
| ユーザーストーリー | US-002 |
| 優先度 | 低 |
| 前提条件 | - モーダルが開いている状態 |
| テスト手順 | 1. テキストエリアに「テスト」（3文字）と入力 |
| 期待結果 | - 文字数カウントが「3 / 2000」と表示される |
| 検証方法 | `await expect(page.locator('.char-count')).toContainText('3 / 2000')` |

---

### US-003: コメント履歴の時系列表示

#### E2E-US003-001: コメント一覧が新しい順に表示される

| 項目 | 内容 |
|------|------|
| テストケースID | E2E-US003-001 |
| ユーザーストーリー | US-003: プロジェクトマネージャーとして、チケットに対するコメント履歴を時系列で確認したい |
| 優先度 | 高 |
| 前提条件 | - TODOCOMMENTテーブルにチケットID=1のコメントが3件存在<br>  - ID=1: "1番目のコメント", createdAt=2025-12-25 10:00:00<br>  - ID=2: "2番目のコメント", createdAt=2025-12-25 11:00:00<br>  - ID=3: "3番目のコメント", createdAt=2025-12-25 12:00:00 |
| テスト手順 | 1. チケットID=1をクリックしてモーダルを開く<br>2. コメント一覧の表示順を確認 |
| 期待結果 | - コメントが新しい順（作成日時の降順）で表示される<br>- 1番目: "3番目のコメント"<br>- 2番目: "2番目のコメント"<br>- 3番目: "1番目のコメント" |
| 検証方法 | `const comments = await page.locator('.comment-item .comment-content').allTextContents()`<br>`expect(comments[0]).toBe('3番目のコメント')`<br>`expect(comments[1]).toBe('2番目のコメント')`<br>`expect(comments[2]).toBe('1番目のコメント')` |

---

### US-004: コメント投稿者と日時の表示

#### E2E-US004-001: コメントに投稿者と相対時間が表示される

| 項目 | 内容 |
|------|------|
| テストケースID | E2E-US004-001 |
| ユーザーストーリー | US-004: チケット担当者として、コメントの投稿者と日時を確認したい |
| 優先度 | 高 |
| 前提条件 | - チケットID=1にコメントが1件存在（投稿者: "テストユーザー", 5分前に投稿） |
| テスト手順 | 1. チケットID=1をクリックしてモーダルを開く<br>2. コメントアイテムのヘッダー情報を確認 |
| 期待結果 | - 投稿者名「テストユーザー」が表示される<br>- 相対時間「5分前」が表示される |
| 検証方法 | `await expect(page.locator('.comment-item .author')).toContainText('テストユーザー')`<br>`await expect(page.locator('.comment-item .timestamp')).toContainText('分前')` |

#### E2E-US004-002: 削除されたユーザーのコメント表示

| 項目 | 内容 |
|------|------|
| テストケースID | E2E-US004-002 |
| ユーザーストーリー | US-004 |
| 優先度 | 中 |
| 前提条件 | - チケットID=1にコメントが1件存在（USER_ID=NULLのコメント） |
| テスト手順 | 1. チケットID=1をクリックしてモーダルを開く<br>2. コメントの投稿者名を確認 |
| 期待結果 | - 投稿者名が「削除されたユーザー」と表示される |
| 検証方法 | `await expect(page.locator('.comment-item .author')).toContainText('削除されたユーザー')` |

---

### US-005: コメント削除機能

#### E2E-US005-001: コメントを削除する

| 項目 | 内容 |
|------|------|
| テストケースID | E2E-US005-001 |
| ユーザーストーリー | US-005: コメント投稿者として、自分が投稿したコメントを削除したい |
| 優先度 | 中 |
| 前提条件 | - チケットID=1にコメントが2件存在<br>- 「コメント (2件)」と表示されている |
| テスト手順 | 1. 削除したいコメントの「削除」ボタンをクリック<br>2. 確認ダイアログが表示される<br>3. ダイアログで「OK」をクリック |
| 期待結果 | - コメントが削除される<br>- コメント一覧から該当コメントが消える<br>- コメント件数が「コメント (1件)」に更新される |
| 検証方法 | `page.on('dialog', dialog => dialog.accept())`<br>`await page.locator('.comment-item .btn-delete').first().click()`<br>`await expect(page.locator('.comment-section h3')).toContainText('コメント (1件)')` |

#### E2E-US005-002: コメント削除をキャンセルする

| 項目 | 内容 |
|------|------|
| テストケースID | E2E-US005-002 |
| ユーザーストーリー | US-005 |
| 優先度 | 低 |
| 前提条件 | - チケットID=1にコメントが2件存在 |
| テスト手順 | 1. 削除したいコメントの「削除」ボタンをクリック<br>2. 確認ダイアログが表示される<br>3. ダイアログで「キャンセル」をクリック |
| 期待結果 | - コメントが削除されない<br>- コメント件数は変わらない（「コメント (2件)」のまま） |
| 検証方法 | `page.on('dialog', dialog => dialog.dismiss())`<br>`await page.locator('.comment-item .btn-delete').first().click()`<br>`await expect(page.locator('.comment-section h3')).toContainText('コメント (2件)')` |

#### E2E-US005-003: 最後のコメントを削除すると空状態になる

| 項目 | 内容 |
|------|------|
| テストケースID | E2E-US005-003 |
| ユーザーストーリー | US-005 |
| 優先度 | 中 |
| 前提条件 | - チケットID=1にコメントが1件のみ存在 |
| テスト手順 | 1. コメントの「削除」ボタンをクリック<br>2. 確認ダイアログで「OK」をクリック |
| 期待結果 | - コメントが削除される<br>- 「コメント (0件)」と表示される<br>- 「コメントはまだありません」というメッセージが表示される |
| 検証方法 | `await expect(page.locator('.comment-section h3')).toContainText('コメント (0件)')`<br>`await expect(page.locator('.empty')).toContainText('コメントはまだありません')` |

---

### US-006: モーダル内でのチケット情報編集

#### E2E-US006-001: モーダル内でチケットを完了にする

| 項目 | 内容 |
|------|------|
| テストケースID | E2E-US006-001 |
| ユーザーストーリー | US-006: チケット担当者として、モーダル内でチケット情報を編集したい |
| 優先度 | 中 |
| 前提条件 | - チケットID=1が未完了状態（completed=false） |
| テスト手順 | 1. チケットID=1をクリックしてモーダルを開く<br>2. ステータスバッジが「未完了」であることを確認<br>3. 「完了にする」ボタンをクリック |
| 期待結果 | - ステータスバッジが「完了」に変わる<br>- 「完了にする」ボタンが非表示になる<br>- チケット一覧画面でも完了状態が反映される（モーダルを閉じた後） |
| 検証方法 | `await expect(page.locator('.badge')).toContainText('完了')`<br>`await expect(page.locator('.btn-toggle')).not.toBeVisible()` |

---

## 3. エンドツーエンドシナリオテスト

### E2E-SCENARIO-001: チケット詳細確認からコメント投稿までの完全フロー

| 項目 | 内容 |
|------|------|
| テストケースID | E2E-SCENARIO-001 |
| シナリオ名 | チケット詳細確認→コメント投稿→削除→モーダル閉じる |
| 優先度 | 高 |
| 前提条件 | - アプリケーションが起動している<br>- チケットID=1が存在（タイトル: "新機能実装", 説明: "ユーザー登録機能を実装する"）<br>- ユーザーID=1が存在（名前: "山田太郎"）<br>- チケットID=1にコメントが0件 |
| テスト手順 | **Step 1: チケット一覧を確認**<br>1. ブラウザで http://localhost:8080/todos.html にアクセス<br>2. チケット一覧に「新機能実装」が表示されることを確認<br><br>**Step 2: チケット詳細を表示**<br>3. 「新機能実装」チケットをクリック<br>4. モーダルが表示されることを確認<br>5. タイトル「新機能実装」、説明「ユーザー登録機能を実装する」が表示されることを確認<br>6. 「コメント (0件)」と表示されることを確認<br>7. 「コメントはまだありません」メッセージが表示されることを確認<br><br>**Step 3: コメントを投稿**<br>8. テキストエリアに「要件確認: ユーザー登録時にメール認証は必要ですか？」と入力<br>9. 投稿者ドロップダウンで「山田太郎」を選択<br>10. 「投稿」ボタンをクリック<br>11. コメントが投稿されることを確認<br>12. 「コメント (1件)」に更新されることを確認<br>13. コメント内容、投稿者名、相対時間が表示されることを確認<br><br>**Step 4: 2件目のコメントを投稿**<br>14. テキストエリアに「進捗報告: 基本設計が完了しました」と入力<br>15. 投稿者ドロップダウンで「山田太郎」を選択<br>16. 「投稿」ボタンをクリック<br>17. 「コメント (2件)」に更新されることを確認<br>18. 新しいコメントが一覧の先頭に表示されることを確認<br><br>**Step 5: コメントを削除**<br>19. 2件目のコメント（古い方）の「削除」ボタンをクリック<br>20. 確認ダイアログで「OK」をクリック<br>21. コメントが削除されることを確認<br>22. 「コメント (1件)」に更新されることを確認<br><br>**Step 6: モーダルを閉じる**<br>23. Escキーを押す<br>24. モーダルが閉じることを確認<br>25. チケット一覧画面に戻ることを確認<br><br>**Step 7: 再度モーダルを開いて状態を確認**<br>26. 再度「新機能実装」チケットをクリック<br>27. 「コメント (1件)」と表示されることを確認<br>28. 残った1件のコメントが正しく表示されることを確認 |
| 期待結果 | - 全ての操作が成功する<br>- コメントの投稿・削除がデータベースに永続化される<br>- モーダルの開閉が正常に動作する<br>- 画面の状態がリアルタイムで更新される |

---

### E2E-SCENARIO-002: 複数チケットのコメント管理

| 項目 | 内容 |
|------|------|
| テストケースID | E2E-SCENARIO-002 |
| シナリオ名 | 複数チケットに対するコメント管理 |
| 優先度 | 中 |
| 前提条件 | - チケットID=1が存在（タイトル: "チケット1"）<br>- チケットID=2が存在（タイトル: "チケット2"）<br>- 両方のチケットにコメントが0件 |
| テスト手順 | 1. チケット1を開く<br>2. コメント「チケット1のコメント」を投稿<br>3. モーダルを閉じる<br>4. チケット2を開く<br>5. コメント「チケット2のコメント」を投稿<br>6. モーダルを閉じる<br>7. チケット1を再度開く<br>8. コメント一覧を確認 |
| 期待結果 | - チケット1には「チケット1のコメント」のみが表示される<br>- チケット2には「チケット2のコメント」のみが表示される<br>- 各チケットのコメントが混在しない |

---

## 4. エラーハンドリングテスト

### E2E-ERROR-001: APIエラー時の挙動確認（コメント取得失敗）

| 項目 | 内容 |
|------|------|
| テストケースID | E2E-ERROR-001 |
| テスト観点 | コメント取得API失敗時のエラー表示 |
| 優先度 | 中 |
| 前提条件 | - バックエンドが起動していない、またはAPIがエラーを返す状態 |
| テスト手順 | 1. チケットをクリックしてモーダルを開く |
| 期待結果 | - エラーメッセージ「コメントの取得に失敗しました」が表示される<br>- コメント一覧は空のまま |
| 検証方法 | MSWやネットワークモックを使用してAPIエラーをシミュレート |

### E2E-ERROR-002: APIエラー時の挙動確認（コメント投稿失敗）

| 項目 | 内容 |
|------|------|
| テストケースID | E2E-ERROR-002 |
| テスト観点 | コメント投稿API失敗時のエラー表示 |
| 優先度 | 中 |
| 前提条件 | - モーダルが開いている状態<br>- コメント投稿APIが500エラーを返す |
| テスト手順 | 1. コメントを入力<br>2. 投稿者を選択<br>3. 投稿ボタンをクリック |
| 期待結果 | - アラート「コメントの投稿に失敗しました」が表示される<br>- コメント一覧は変わらない |
| 検証方法 | MSWでPOST /api/todos/:id/comments を500エラーに設定 |

---

## 5. パフォーマンステスト

### E2E-PERF-001: 大量コメントの表示パフォーマンス

| 項目 | 内容 |
|------|------|
| テストケースID | E2E-PERF-001 |
| テスト観点 | 100件のコメントを持つチケットのモーダル表示速度 |
| 優先度 | 低 |
| 前提条件 | - チケットID=1に100件のコメントが存在 |
| テスト手順 | 1. チケットをクリック<br>2. モーダル表示までの時間を計測 |
| 期待結果 | - モーダルが3秒以内に表示される<br>- コメント一覧が正常にスクロール可能 |
| 検証方法 | Playwrightのタイミングメトリクスを使用 |

---

## 6. ブラウザ互換性テスト

### E2E-COMPAT-001: Chromiumでの動作確認

| 項目 | 内容 |
|------|------|
| テストケースID | E2E-COMPAT-001 |
| テスト観点 | Chromiumブラウザでの全機能動作 |
| 優先度 | 高 |
| テスト手順 | E2E-SCENARIO-001をChromiumで実行 |
| 期待結果 | 全ての機能が正常に動作する |

### E2E-COMPAT-002: Firefoxでの動作確認

| 項目 | 内容 |
|------|------|
| テストケースID | E2E-COMPAT-002 |
| テスト観点 | Firefoxブラウザでの全機能動作 |
| 優先度 | 中 |
| テスト手順 | E2E-SCENARIO-001をFirefoxで実行 |
| 期待結果 | 全ての機能が正常に動作する |

### E2E-COMPAT-003: WebKitでの動作確認

| 項目 | 内容 |
|------|------|
| テストケースID | E2E-COMPAT-003 |
| テスト観点 | WebKit（Safari）ブラウザでの全機能動作 |
| 優先度 | 中 |
| テスト手順 | E2E-SCENARIO-001をWebKitで実行 |
| 期待結果 | 全ての機能が正常に動作する |

---

## 7. テストケース一覧

| ID | カテゴリ | テスト観点 | 優先度 | ステータス |
|----|---------|-----------|--------|-----------|
| E2E-US001-001 | US-001 | チケットをクリックして詳細モーダルを表示 | 高 | 未実施 |
| E2E-US001-002 | US-001 | モーダルを閉じるボタンで閉じる | 高 | 未実施 |
| E2E-US001-003 | US-001 | Escキーでモーダルを閉じる | 中 | 未実施 |
| E2E-US001-004 | US-001 | オーバーレイクリックでモーダルを閉じる | 中 | 未実施 |
| E2E-US002-001 | US-002 | コメントを投稿する | 高 | 未実施 |
| E2E-US002-002 | US-002 | 連続して複数のコメントを投稿する | 中 | 未実施 |
| E2E-US002-003 | US-002 | コメント投稿時のバリデーション（空コンテンツ） | 高 | 未実施 |
| E2E-US002-004 | US-002 | コメント投稿時のバリデーション（投稿者未選択） | 高 | 未実施 |
| E2E-US002-005 | US-002 | 文字数カウント表示 | 低 | 未実施 |
| E2E-US003-001 | US-003 | コメント一覧が新しい順に表示される | 高 | 未実施 |
| E2E-US004-001 | US-004 | コメントに投稿者と相対時間が表示される | 高 | 未実施 |
| E2E-US004-002 | US-004 | 削除されたユーザーのコメント表示 | 中 | 未実施 |
| E2E-US005-001 | US-005 | コメントを削除する | 中 | 未実施 |
| E2E-US005-002 | US-005 | コメント削除をキャンセルする | 低 | 未実施 |
| E2E-US005-003 | US-005 | 最後のコメントを削除すると空状態になる | 中 | 未実施 |
| E2E-US006-001 | US-006 | モーダル内でチケットを完了にする | 中 | 未実施 |
| E2E-SCENARIO-001 | シナリオ | チケット詳細確認→コメント投稿→削除→モーダル閉じる | 高 | 未実施 |
| E2E-SCENARIO-002 | シナリオ | 複数チケットに対するコメント管理 | 中 | 未実施 |
| E2E-ERROR-001 | エラー | コメント取得失敗時のエラー表示 | 中 | 未実施 |
| E2E-ERROR-002 | エラー | コメント投稿失敗時のエラー表示 | 中 | 未実施 |
| E2E-PERF-001 | パフォーマンス | 大量コメントの表示パフォーマンス | 低 | 未実施 |
| E2E-COMPAT-001 | 互換性 | Chromiumでの動作確認 | 高 | 未実施 |
| E2E-COMPAT-002 | 互換性 | Firefoxでの動作確認 | 中 | 未実施 |
| E2E-COMPAT-003 | 互換性 | WebKitでの動作確認 | 中 | 未実施 |

**合計**: 24件

---

## 8. テストデータセットアップ

### 8.1 データベース初期化スクリプト

```sql
-- テストデータのクリーンアップ
DELETE FROM TODOCOMMENT;
DELETE FROM TODO WHERE ID IN (1, 2, 3);
DELETE FROM USER WHERE ID IN (1, 2, 3);

-- ユーザーデータ
INSERT INTO USER (ID, NAME, EMAIL) VALUES
(1, '山田太郎', 'yamada@example.com'),
(2, '佐藤花子', 'sato@example.com'),
(3, '鈴木一郎', 'suzuki@example.com');

-- チケットデータ
INSERT INTO TODO (ID, TITLE, DESCRIPTION, COMPLETED, START_DATE, DUE_DATE, ASSIGNEE_ID, CREATED_AT) VALUES
(1, '新機能実装', 'ユーザー登録機能を実装する', FALSE, '2025-12-20', '2025-12-31', 1, CURRENT_TIMESTAMP),
(2, 'バグ修正', 'ログイン画面のエラー修正', FALSE, '2025-12-22', '2025-12-28', 2, CURRENT_TIMESTAMP),
(3, '完了済みタスク', 'テストデータ作成', TRUE, '2025-12-15', '2025-12-20', 1, CURRENT_TIMESTAMP);

-- コメントデータ（テストケースに応じて投入）
-- E2E-US003-001用
INSERT INTO TODOCOMMENT (ID, TODO_ID, USER_ID, CONTENT, CREATED_AT) VALUES
(1, 1, 1, '1番目のコメント', '2025-12-25 10:00:00'),
(2, 1, 2, '2番目のコメント', '2025-12-25 11:00:00'),
(3, 1, 3, '3番目のコメント', '2025-12-25 12:00:00');
```

### 8.2 Playwright設定ファイル

```typescript
// playwright.config.ts
import { defineConfig, devices } from '@playwright/test'

export default defineConfig({
  testDir: './e2e',
  fullyParallel: false, // テストデータの競合を避けるため
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,
  workers: 1, // データベース操作の競合を避けるため
  reporter: 'html',

  use: {
    baseURL: 'http://localhost:8080',
    trace: 'on-first-retry',
    screenshot: 'only-on-failure',
  },

  projects: [
    {
      name: 'chromium',
      use: { ...devices['Desktop Chrome'] },
    },
    {
      name: 'firefox',
      use: { ...devices['Desktop Firefox'] },
    },
    {
      name: 'webkit',
      use: { ...devices['Desktop Safari'] },
    },
  ],

  webServer: {
    command: 'mvn spring-boot:run',
    url: 'http://localhost:8080',
    reuseExistingServer: !process.env.CI,
    timeout: 120000,
  },
})
```

---

## 9. テスト実行

### 9.1 実行コマンド

```bash
# 全E2Eテスト実行
npx playwright test

# 特定ブラウザのみ
npx playwright test --project=chromium

# UIモードで実行（デバッグ用）
npx playwright test --ui

# 特定テストファイルのみ
npx playwright test e2e/comment-crud.spec.ts

# ヘッドレスモードOFF（ブラウザ表示）
npx playwright test --headed

# デバッグモード
npx playwright test --debug
```

### 9.2 レポート確認

```bash
# テスト結果レポートを開く
npx playwright show-report
```

---

## 10. 成功基準

### 10.1 テスト合格基準

| 項目 | 基準 |
|------|------|
| 優先度「高」のテスト | 100%合格 |
| 優先度「中」のテスト | 90%以上合格 |
| 優先度「低」のテスト | 80%以上合格 |
| 全体合格率 | 95%以上 |

### 10.2 パフォーマンス基準

| 項目 | 基準 |
|------|------|
| モーダル表示速度 | 2秒以内 |
| コメント投稿レスポンス | 1秒以内 |
| コメント削除レスポンス | 1秒以内 |

---

## 改版履歴

| 版数 | 日付 | 変更内容 | 変更者 |
|------|------|----------|--------|
| 1.0 | 2025-12-25 | 初版作成 | システム管理者 |
