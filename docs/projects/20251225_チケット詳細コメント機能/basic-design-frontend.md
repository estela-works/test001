# フロントエンド基本設計書

## 案件情報

| 項目 | 内容 |
|------|------|
| 案件名 | ToDoチケット詳細モーダル＋コメント機能 |
| 案件ID | 20251225_チケット詳細コメント機能 |
| 作成日 | 2025-12-25 |
| 関連要件整理書 | [requirements.md](./requirements.md) |

---

## 1. 概要

### 1.1 本設計書の目的

チケット詳細モーダルとコメント機能追加に伴うフロントエンドの画面・UI・操作フローの基本設計を定義する。

### 1.2 フロントエンドの役割

| 責務 | 説明 |
|------|------|
| 画面表示 | モーダルでチケット詳細とコメント一覧を表示 |
| ユーザー操作 | コメント投稿・削除、モーダルの開閉操作 |
| 状態管理 | モーダル状態、コメントデータの管理 |
| API連携 | コメントCRUD APIとの通信 |

---

## 2. 技術要件

### 2.1 使用技術

| 項目 | 技術 | バージョン |
|------|------|-----------|
| フレームワーク | Vue.js | 3.x |
| 言語 | TypeScript | 5.x |
| 状態管理 | Pinia | 2.x（既存踏襲） |
| ルーティング | Vue Router | 4.x（既存踏襲） |
| API通信 | Fetch API | ブラウザ標準 |
| スタイル | CSS（インライン/scoped） | - |

---

## 3. 画面要件

### 3.1 変更対象画面

| ID | 画面名 | パス | 変更内容 | 対応US |
|----|--------|------|----------|--------|
| SC-002 | ToDo管理画面 | /todos | チケット詳細モーダルを追加 | US-001, US-002, US-003, US-004, US-005 |

### 3.2 新規コンポーネント

| コンポーネント名 | 種別 | 説明 |
|----------------|------|------|
| TodoDetailModal | モーダル | チケット詳細とコメント機能を統合したモーダル |
| CommentList | リスト | コメント一覧を時系列表示 |
| CommentForm | フォーム | コメント投稿フォーム |
| CommentItem | アイテム | 個別コメントの表示（投稿者・日時・削除ボタン） |

---

## 4. コンポーネント詳細

### 4.1 TodoDetailModal（新規）

| 項目 | 内容 |
|------|------|
| 役割 | チケット詳細情報とコメント機能を統合したモーダルウィンドウ |
| 親コンポーネント | TodoList.vue |
| 子コンポーネント | CommentList, CommentForm |

#### Props

| プロップ名 | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| todoId | number | 必須 | 表示するToDoのID |
| isOpen | boolean | 必須 | モーダルの開閉状態 |

#### Events

| イベント名 | ペイロード | 説明 |
|-----------|-----------|------|
| close | なし | モーダルを閉じる |
| todoUpdated | todo: Todo | チケット情報が更新された |

#### レイアウト

```
┌──────────────────────────────────────────────┐
│  × チケット詳細               [閉じる]        │ ← ヘッダー
├──────────────────────────────────────────────┤
│                                              │
│  【チケット情報エリア】                        │
│  タイトル: ○○○○                              │
│  説明: ××××                                  │
│  ステータス: ● 未完了  [完了にする]           │
│  開始日: YYYY/MM/DD                          │
│  終了日: YYYY/MM/DD                          │
│  担当: 山田太郎 ▼                            │
│  作成日時: YYYY/MM/DD HH:MM                  │
│                                              │
│  ─────────────────────────────────────      │
│                                              │
│  【コメントエリア】                            │
│  コメント (X件)                               │
│                                              │
│  ┌──────────────────────────────────────┐   │
│  │ CommentForm（投稿フォーム）           │   │
│  │ [テキストエリア]                     │   │
│  │ 投稿者: [ユーザー選択 ▼]  [投稿]     │   │
│  └──────────────────────────────────────┘   │
│                                              │
│  ┌──────────────────────────────────────┐   │
│  │ CommentItem                          │   │
│  │ 山田太郎 • 2025/12/25 14:30    [削除] │   │
│  │ この件について確認しました。           │   │
│  └──────────────────────────────────────┘   │
│                                              │
│  ┌──────────────────────────────────────┐   │
│  │ CommentItem                          │   │
│  │ 鈴木花子 • 2025/12/25 10:15    [削除] │   │
│  │ 進捗状況を報告します。                 │   │
│  └──────────────────────────────────────┘   │
│                                              │
└──────────────────────────────────────────────┘
```

#### 表示仕様

| 要素 | 表示内容 |
|------|---------|
| タイトル | チケットのタイトル（太字） |
| 説明 | チケットの説明 |
| ステータス | 完了/未完了バッジ表示 |
| 期間 | 開始日〜終了日（未設定時は「未設定」） |
| 担当者 | 担当者名（未設定時は「未割当」） |
| 作成日時 | YYYY/MM/DD HH:MM形式 |
| コメント件数 | コメント数をリアルタイム表示 |

---

### 4.2 CommentList（新規）

| 項目 | 内容 |
|------|------|
| 役割 | コメント一覧を時系列（新しい順）で表示 |
| 親コンポーネント | TodoDetailModal |
| 子コンポーネント | CommentItem |

#### Props

| プロップ名 | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| todoId | number | 必須 | ToDoのID |

#### State

| 状態名 | 型 | 説明 |
|--------|-----|------|
| comments | Comment[] | コメント一覧 |
| loading | boolean | 読み込み中フラグ |
| error | string \| null | エラーメッセージ |

#### Events

| イベント名 | ペイロード | 説明 |
|-----------|-----------|------|
| commentDeleted | commentId: number | コメントが削除された |

---

### 4.3 CommentForm（新規）

| 項目 | 内容 |
|------|------|
| 役割 | コメント投稿フォーム |
| 親コンポーネント | TodoDetailModal |

#### Props

| プロップ名 | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| todoId | number | 必須 | ToDoのID |

#### State

| 状態名 | 型 | 説明 |
|--------|-----|------|
| content | string | コメント内容 |
| userId | number \| null | 選択された投稿者ID |
| submitting | boolean | 投稿処理中フラグ |

#### Events

| イベント名 | ペイロード | 説明 |
|-----------|-----------|------|
| commentCreated | comment: Comment | コメントが作成された |

#### バリデーション

| 項目 | ルール |
|------|--------|
| content | 必須、最大2000文字 |
| userId | 必須 |

#### 表示仕様

| 要素 | 仕様 |
|------|------|
| テキストエリア | 3〜5行、placeholder="コメントを入力..." |
| 投稿者選択 | ドロップダウン、ユーザー一覧から選択 |
| 投稿ボタン | 入力必須項目未入力時は無効化 |

---

### 4.4 CommentItem（新規）

| 項目 | 内容 |
|------|------|
| 役割 | 個別コメントの表示 |
| 親コンポーネント | CommentList |

#### Props

| プロップ名 | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| comment | Comment | 必須 | コメントデータ |

#### Events

| イベント名 | ペイロード | 説明 |
|-----------|-----------|------|
| delete | commentId: number | 削除ボタンクリック |

#### 表示仕様

| 要素 | 表示内容 |
|------|---------|
| 投稿者名 | ユーザー名（太字） |
| 投稿日時 | YYYY/MM/DD HH:MM形式 |
| コメント内容 | テキスト（改行対応、HTMLエスケープ済み） |
| 削除ボタン | 確認ダイアログ後に削除実行 |

---

## 5. データ型定義

### 5.1 Comment型

```typescript
interface Comment {
  id: number;
  todoId: number;
  userId: number | null;
  userName: string | null;
  content: string;
  createdAt: string; // ISO 8601形式
}
```

### 5.2 CommentCreateRequest型

```typescript
interface CommentCreateRequest {
  userId: number;
  content: string;
}
```

---

## 6. イベント一覧

### 6.1 モーダル操作

| イベントID | イベント名 | トリガー | 処理概要 |
|-----------|-----------|---------|---------|
| EV-MOD-01 | モーダルを開く | ToDoカードクリック | todoIdを指定してモーダルを表示 |
| EV-MOD-02 | モーダルを閉じる | ×ボタン/背景クリック/Escキー | モーダルを非表示 |

### 6.2 コメント操作

| イベントID | イベント名 | トリガー | 処理概要 |
|-----------|-----------|---------|---------|
| EV-COM-01 | コメント一覧取得 | モーダル表示時 | GET /api/todos/{todoId}/comments |
| EV-COM-02 | コメント投稿 | 投稿ボタンクリック | POST /api/todos/{todoId}/comments |
| EV-COM-03 | コメント削除 | 削除ボタンクリック | 確認後にDELETE /api/comments/{id} |

---

## 7. API連携

### 7.1 使用API

| 操作 | API | メソッド | タイミング |
|------|-----|---------|-----------|
| コメント一覧取得 | /api/todos/{todoId}/comments | GET | モーダル表示時 |
| コメント投稿 | /api/todos/{todoId}/comments | POST | 投稿ボタンクリック |
| コメント削除 | /api/comments/{id} | DELETE | 削除確認後 |
| チケット詳細取得 | /api/todos/{id} | GET | モーダル表示時 |
| ユーザー一覧取得 | /api/users | GET | モーダル表示時（投稿者選択用） |

### 7.2 エラーハンドリング

| エラー | HTTPステータス | 表示 |
|--------|--------------|------|
| ネットワークエラー | - | 「通信エラーが発生しました」 |
| コメント投稿失敗 | 400/404 | 「コメントの投稿に失敗しました」 |
| コメント削除失敗 | 404 | 「コメントの削除に失敗しました」 |
| コメント取得失敗 | 404 | 「コメントの取得に失敗しました」 |

---

## 8. 状態管理（Pinia Store）

### 8.1 CommentStore（新規）

#### State

```typescript
interface CommentState {
  comments: Comment[];
  loading: boolean;
  error: string | null;
}
```

#### Actions

| アクション名 | 引数 | 説明 |
|------------|------|------|
| fetchComments | todoId: number | コメント一覧取得 |
| createComment | todoId: number, request: CommentCreateRequest | コメント投稿 |
| deleteComment | commentId: number | コメント削除 |
| clearComments | なし | コメントをクリア（モーダル閉じる時） |

---

## 9. UI状態・フィードバック

### 9.1 モーダル状態

| 状態 | 表示 |
|------|------|
| 読み込み中 | スピナー表示、コンテンツはグレーアウト |
| エラー発生 | エラーメッセージ表示（赤背景） |
| データなし | 「コメントはまだありません」 |

### 9.2 操作フィードバック

| 操作 | フィードバック |
|------|--------------|
| コメント投稿 | 投稿完了後にフォームをクリア、一覧に即座に反映 |
| コメント削除 | 確認ダイアログ表示、削除後に一覧から即座に削除 |
| モーダル閉じる | フェードアウトアニメーション |

---

## 10. 非機能要件

### 10.1 ユーザビリティ

| 項目 | 要件 |
|------|------|
| 応答性 | モーダル表示・コメント投稿・削除は1秒以内 |
| キーボード操作 | Escキーでモーダルを閉じる |
| フィードバック | 操作結果を即座に画面に反映 |

### 10.2 アクセシビリティ

| 項目 | 対応 |
|------|------|
| フォーカス管理 | モーダル表示時に最初の入力欄にフォーカス |
| タブ操作 | モーダル内でタブ移動可能 |
| スクリーンリーダー | aria-label適切に設定 |

---

## 11. 制約条件

| 項目 | 制約 |
|------|------|
| 対応ブラウザ | Chrome/Firefox/Edge 最新版（既存踏襲） |
| レスポンシブ | 非対応（デスクトップ優先） |
| モーダル | 同時に1つのみ表示可能 |

---

## 12. スタイル仕様

### 12.1 モーダルスタイル

| 要素 | スタイル |
|------|---------|
| オーバーレイ | 半透明黒背景（rgba(0,0,0,0.5)） |
| モーダル本体 | 白背景、角丸、影付き、最大幅800px |
| ヘッダー | 灰色背景、太字タイトル、×ボタン |
| コンテンツ | スクロール可能（max-height: 70vh） |

### 12.2 コメントスタイル

| 要素 | スタイル |
|------|---------|
| コメントカード | 白背景、枠線、角丸、マージン |
| 投稿者名 | 太字、色はプライマリカラー |
| 投稿日時 | グレー、小さいフォント |
| 削除ボタン | 赤色、右上配置 |

---

## 13. テスト要件

### 13.1 単体テスト（Vitest）

| 対象 | テストケース |
|------|------------|
| CommentForm | バリデーション、投稿処理 |
| CommentItem | 削除処理、表示 |
| CommentStore | API連携、状態管理 |

### 13.2 E2Eテスト（Playwright）

| シナリオ | 確認内容 |
|---------|---------|
| モーダル表示 | クリックでモーダルが表示される |
| コメント投稿 | コメントを投稿すると一覧に反映される |
| コメント削除 | コメントを削除すると一覧から削除される |
| モーダル閉じる | ×ボタン/背景クリックで閉じる |

---

## 14. 関連設計書

| ドキュメント | 説明 |
|-------------|------|
| [detail-design-frontend.md](./detail-design-frontend.md) | フロントエンド詳細設計書（作成予定） |
| [basic-design-backend.md](./basic-design-backend.md) | バックエンド基本設計書 |

---

## 改版履歴

| 版数 | 日付 | 変更内容 | 変更者 |
|------|------|----------|--------|
| 1.0 | 2025-12-25 | 初版作成 | システム管理者 |
