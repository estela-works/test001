# 要件整理書

## 案件情報

| 項目 | 内容 |
|------|------|
| 案件名 | ToDoチケット詳細モーダル＋コメント機能 |
| 案件ID | 20251225_チケット詳細コメント機能 |
| 作成日 | 2025-12-25 |
| 作成者 | システム管理者 |
| ステータス | 検討中 |

---

## 1. 案件概要

### 1.1 案件の背景

現在のToDoアプリケーションでは、チケット一覧画面で基本情報（タイトル、期限、担当者等）の確認と編集ができるが、以下の課題がある：

- チケットの詳細情報を一覧画面で確認すると画面が煩雑になる
- タスクに関する議論や補足情報を記録する場がない
- チケットに対するコミュニケーション履歴が追跡できない
- チームメンバー間での情報共有が不十分

これらの課題を解決するため、チケット詳細を専用のモーダルで表示し、さらにコメント機能を追加することで、チケットを中心としたコミュニケーションを促進する。

### 1.2 案件の目的

この案件で達成したいこと：

1. **詳細情報の集約表示**: チケットに関する全情報を一つのモーダルで確認できる
2. **コミュニケーション促進**: チケットに対するコメントを時系列で記録・共有できる
3. **作業効率の向上**: 一覧画面と詳細画面の切り替えをスムーズにし、ユーザビリティを向上
4. **情報の追跡性**: いつ誰がどのようなコメントを残したかを記録し、チケットの変遷を追跡可能に

### 1.3 対象ユーザー

| ユーザー | 利用シーン |
|---------|-----------|
| チケット担当者 | 自分のチケットに補足情報を記録したい時、進捗状況を共有したい時 |
| プロジェクトマネージャー | チケットの詳細を確認し、指示やフィードバックをコメントで残したい時 |
| チームメンバー | 他のメンバーのチケットを確認し、質問や提案をコメントで伝えたい時 |

---

## 2. 要求一覧

### 2.1 ビジネス要求

| ID | 要求 | 優先度 | 理由 |
|----|------|--------|------|
| BR-001 | チケット詳細を専用モーダルで表示する | 必須 | 一覧画面を煩雑にせず、詳細情報にアクセスできるようにするため |
| BR-002 | チケットに対してコメントを追加できる | 必須 | チケットに関する議論や補足情報を記録するため |
| BR-003 | コメントを時系列で表示する | 必須 | 情報の流れを把握しやすくするため |
| BR-004 | コメント投稿者と投稿日時を記録する | 必須 | 誰がいつコメントしたかを追跡するため |
| BR-005 | コメントを削除できる | 必須 | 誤投稿や不要な情報を削除できるようにするため |
| BR-006 | モーダルからチケット情報を編集できる | 希望 | 詳細確認と編集をシームレスに行えるようにするため |

### 2.2 ユーザー要求（ユーザーストーリー）

| ID | ユーザーストーリー | 対応BR | 優先度 |
|----|-------------------|--------|--------|
| US-001 | チケット担当者として、チケットをクリックして詳細をモーダルで表示したい。なぜなら、全体像を一箇所で確認できるから。 | BR-001 | 高 |
| US-002 | チームメンバーとして、チケットに進捗報告や質問をコメントとして追加したい。なぜなら、チケット単位で情報を集約できるから。 | BR-002 | 高 |
| US-003 | プロジェクトマネージャーとして、チケットに対するコメント履歴を時系列で確認したい。なぜなら、チケットの変遷を理解できるから。 | BR-003 | 高 |
| US-004 | チケット担当者として、コメントの投稿者と日時を確認したい。なぜなら、誰がいつ何を言ったかを把握する必要があるから。 | BR-004 | 高 |
| US-005 | コメント投稿者として、自分が投稿したコメントを削除したい。なぜなら、誤って投稿した内容を訂正できるから。 | BR-005 | 中 |
| US-006 | チケット担当者として、モーダル内でチケット情報を編集したい。なぜなら、詳細確認しながらすぐに修正できるから。 | BR-006 | 中 |

---

## 3. スコープ定義

### 3.1 スコープ内（In Scope）

| カテゴリ | 項目 | 説明 |
|---------|------|------|
| 機能 | チケット詳細モーダル表示 | クリックでチケットの全情報をモーダルで表示 |
| 機能 | コメント追加機能 | テキストエリアでコメントを入力・投稿 |
| 機能 | コメント一覧表示 | チケットに紐づくコメントを時系列で表示 |
| 機能 | コメント削除機能 | 既存コメントを削除できる |
| 機能 | コメント投稿者・日時表示 | 各コメントに投稿者名と投稿日時を表示 |
| データベース | TODOCOMMENTテーブル追加 | コメントを永続化する新規テーブル |
| API | コメントCRUD API | コメントの作成・取得・削除エンドポイント |
| 画面 | チケット詳細モーダル | todos.html に追加するオーバーレイモーダル |
| 画面 | コメントセクション | モーダル内のコメント表示・入力エリア |
| 技術 | バックエンド | Java + Spring Boot + MyBatis で実装 |
| 技術 | フロントエンド | Vanilla JavaScript で実装 |

### 3.2 スコープ外（Out of Scope）

| 項目 | 見送り理由 | 将来検討 |
|------|-----------|---------|
| コメント編集機能 | 初期リリースでは削除＋再投稿で対応可能 | 可 |
| コメントへの返信機能 | ネスト構造は複雑性が高い | 可 |
| リッチテキスト編集 | プレーンテキストで十分 | 可 |
| コメント通知機能 | 認証機能がないため実装困難 | 不可 |
| コメント検索機能 | データ量が少ない段階では不要 | 可 |
| 添付ファイル機能 | ファイル管理の複雑性が高い | 可 |
| いいね・リアクション機能 | 基本的なコメント機能を優先 | 可 |

---

## 4. 機能要件

### 4.1 機能一覧

| ID | 機能名 | 概要 | 対応US | 優先度 |
|----|--------|------|--------|--------|
| F-001 | チケット詳細モーダル表示 | チケットをクリックするとモーダルで全情報を表示 | US-001 | 必須 |
| F-002 | モーダル閉じる | 背景クリックまたは×ボタンでモーダルを閉じる | US-001 | 必須 |
| F-003 | コメント一覧表示 | チケットに紐づくコメントを新しい順に表示 | US-003 | 必須 |
| F-004 | コメント投稿 | テキストエリアに入力してコメントを追加 | US-002 | 必須 |
| F-005 | コメント削除 | 各コメントの削除ボタンでコメントを削除 | US-005 | 必須 |
| F-006 | 投稿者・日時表示 | 各コメントに投稿者名と投稿日時を表示 | US-004 | 必須 |
| F-007 | モーダル内チケット編集 | モーダル内でチケット情報をインライン編集 | US-006 | 希望 |

### 4.2 画面一覧

| ID | 画面名 | パス | 概要 |
|----|--------|------|------|
| SC-001 | チケット管理画面（拡張） | /todos.html | 既存画面にモーダル機能を追加 |
| SC-002 | チケット詳細モーダル | (モーダル) | チケット詳細とコメントを表示するオーバーレイ |

---

## 5. 非機能要件

### 5.1 性能要件

| 項目 | 要件 | 測定方法 |
|------|------|---------|
| モーダル表示速度 | クリックから表示まで1秒以内 | ブラウザ開発者ツールで測定 |
| コメント投稿速度 | 投稿ボタンクリックから表示まで1秒以内 | ブラウザ開発者ツールで測定 |
| コメント一覧取得 | 100件までのコメントを1秒以内に取得 | APIレスポンスタイム測定 |

### 5.2 可用性要件

| 項目 | 要件 |
|------|------|
| エラー処理 | API呼び出し失敗時はユーザーにエラーメッセージを表示 |
| データ整合性 | チケット削除時は関連コメントも削除（CASCADE） |

### 5.3 セキュリティ要件

| 項目 | 対応 |
|------|------|
| XSS対策 | コメント表示時はHTMLエスケープを実施 |
| SQLインジェクション対策 | MyBatis のパラメータバインディングを使用 |

### 5.4 保守性要件

| 項目 | 要件 |
|------|------|
| コード品質 | 既存のコーディング規約に準拠 |
| テスト | JUnitテストとE2Eテストを追加 |
| ドキュメント | API仕様書、画面仕様書を作成 |

---

## 6. 制約条件

### 6.1 技術制約

| 項目 | 制約 |
|------|------|
| 技術スタック | 既存のSpring Boot 3.2 + Java 17 + MyBatis + Vanilla JSを継続使用 |
| データベース | H2 Database（ファイルモード）を継続使用 |
| 認証機能 | 現時点では認証機能がないため、コメント投稿者は手動選択 |

### 6.2 環境制約

| 項目 | 制約 |
|------|------|
| 開発環境 | Windows環境での開発 |
| ブラウザ対応 | モダンブラウザ（Chrome, Firefox, Edge最新版） |

### 6.3 その他の制約

| 項目 | 制約 |
|------|------|
| 既存機能への影響 | 既存のチケット管理機能に影響を与えない |
| データ移行 | 既存データへの影響なし（新規テーブル追加のみ） |

---

## 7. 前提条件

| 項目 | 前提 |
|------|------|
| ユーザー管理機能 | 既存のUSERテーブルとユーザー管理機能が稼働している |
| チケット管理機能 | 既存のTODOテーブルとチケット管理機能が稼働している |
| 開発環境 | Java 17、Maven、Node.jsがインストール済み |

---

## 8. 受入条件

### 8.1 機能面

| 条件 | 確認方法 |
|------|---------|
| チケットをクリックすると詳細モーダルが表示される | E2Eテストで確認 |
| モーダルにチケットの全情報が表示される | 画面確認 |
| モーダルにコメント一覧が時系列で表示される | 画面確認 |
| コメントを投稿すると一覧に即座に反映される | E2Eテストで確認 |
| コメントを削除すると一覧から削除される | E2Eテストで確認 |
| モーダルの背景クリックまたは×ボタンで閉じられる | E2Eテストで確認 |
| 各コメントに投稿者名と日時が表示される | 画面確認 |

### 8.2 非機能面

| 条件 | 確認方法 |
|------|---------|
| モーダル表示が1秒以内に完了する | 開発者ツールで測定 |
| コメント投稿が1秒以内に完了する | 開発者ツールで測定 |
| コメント内のHTMLタグがエスケープされる | XSSテスト実施 |
| チケット削除時に関連コメントも削除される | JUnitテストで確認 |

---

## 9. 用語定義

| 用語 | 定義 |
|------|------|
| チケット | TODOテーブルに格納されるタスク情報 |
| コメント | チケットに紐づく補足情報やコミュニケーション記録 |
| モーダル | 画面上にオーバーレイで表示される詳細情報ウィンドウ |
| 時系列表示 | 作成日時の降順（新しいコメントが上）で表示すること |

---

## 10. 関連ドキュメント

| ドキュメント | 説明 |
|-------------|------|
| [basic-design.md](./basic-design.md) | 基本設計書（作成予定） |
| [detail-design-api.md](./detail-design-api.md) | API詳細設計書（作成予定） |
| [detail-design-frontend.md](./detail-design-frontend.md) | フロントエンド詳細設計書（作成予定） |
| [detail-design-sql.md](./detail-design-sql.md) | SQL詳細設計書（作成予定） |
| [test-spec.md](./test-spec.md) | テスト仕様書（作成予定） |
| [../../specs/db-schema.md](../../specs/db-schema.md) | 既存DB構造仕様書 |
| [../../specs/api-catalog.md](../../specs/api-catalog.md) | 既存API一覧 |

---

## 改版履歴

| 版数 | 日付 | 変更内容 | 変更者 |
|------|------|----------|--------|
| 1.0 | 2025-12-25 | 初版作成 | システム管理者 |
