# API詳細設計書

## 案件情報

| 項目 | 内容 |
|------|------|
| 案件名 | ToDoアプリケーション初期構築 |
| 案件ID | 202512_初期構築 |
| 作成日 | 2025-12-22 |
| 関連基本設計書 | [basic-design-backend.md](./basic-design-backend.md) |

---

## 1. 概要

### 1.1 本設計書の目的

REST APIエンドポイントの詳細仕様（リクエスト/レスポンス、バリデーション）を定義する。

### 1.2 API共通仕様

| 項目 | 内容 |
|------|------|
| ベースURL | `/api/todos` |
| コンテンツタイプ | application/json |
| 文字コード | UTF-8 |

---

## 2. エンドポイント詳細

### 2.1 GET /api/todos - 全件取得

| 項目 | 内容 |
|------|------|
| URL | `/api/todos` |
| メソッド | GET |
| 認証 | 不要 |

#### クエリパラメータ

| パラメータ | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| completed | boolean | 任意 | true=完了のみ, false=未完了のみ |

#### レスポンス

**成功時 (200)**:
```json
[
  {
    "id": 1,
    "title": "タスク名",
    "description": "説明",
    "completed": false,
    "createdAt": "2025-12-22T10:00:00"
  }
]
```

---

### 2.2 GET /api/todos/{id} - 単一取得

| 項目 | 内容 |
|------|------|
| URL | `/api/todos/{id}` |
| メソッド | GET |

#### パスパラメータ

| パラメータ | 型 | 説明 |
|-----------|-----|------|
| id | Long | ToDoのID |

#### レスポンス

| ステータス | 条件 | ボディ |
|-----------|------|--------|
| 200 | 成功 | Todoオブジェクト |
| 404 | 指定IDが存在しない | なし |

---

### 2.3 GET /api/todos/stats - 統計取得

| 項目 | 内容 |
|------|------|
| URL | `/api/todos/stats` |
| メソッド | GET |

#### レスポンス

**成功時 (200)**:
```json
{
  "total": 3,
  "completed": 1,
  "pending": 2
}
```

---

### 2.4 POST /api/todos - 新規作成

| 項目 | 内容 |
|------|------|
| URL | `/api/todos` |
| メソッド | POST |

#### リクエストボディ

```json
{
  "title": "タスク名",
  "description": "説明"
}
```

| フィールド | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| title | string | 必須 | タイトル |
| description | string | 任意 | 説明 |

#### バリデーション

| 項目 | ルール | エラー時 |
|------|--------|---------|
| title | null/空文字不可 | 400 Bad Request |

#### レスポンス

| ステータス | 条件 | ボディ |
|-----------|------|--------|
| 201 | 作成成功 | 作成されたTodoオブジェクト |
| 400 | バリデーションエラー | なし |

---

### 2.5 PUT /api/todos/{id} - 更新

| 項目 | 内容 |
|------|------|
| URL | `/api/todos/{id}` |
| メソッド | PUT |

#### パスパラメータ

| パラメータ | 型 | 説明 |
|-----------|-----|------|
| id | Long | ToDoのID |

#### リクエストボディ

```json
{
  "title": "更新後タイトル",
  "description": "更新後説明",
  "completed": true
}
```

#### レスポンス

| ステータス | 条件 | ボディ |
|-----------|------|--------|
| 200 | 更新成功 | 更新後のTodoオブジェクト |
| 404 | 指定IDが存在しない | なし |

**注意**: createdAtは更新されない

---

### 2.6 PATCH /api/todos/{id}/toggle - 完了切替

| 項目 | 内容 |
|------|------|
| URL | `/api/todos/{id}/toggle` |
| メソッド | PATCH |

#### パスパラメータ

| パラメータ | 型 | 説明 |
|-----------|-----|------|
| id | Long | ToDoのID |

#### レスポンス

| ステータス | 条件 | ボディ |
|-----------|------|--------|
| 200 | 切替成功 | 更新後のTodoオブジェクト |
| 404 | 指定IDが存在しない | なし |

---

### 2.7 DELETE /api/todos/{id} - 単一削除

| 項目 | 内容 |
|------|------|
| URL | `/api/todos/{id}` |
| メソッド | DELETE |

#### パスパラメータ

| パラメータ | 型 | 説明 |
|-----------|-----|------|
| id | Long | ToDoのID |

#### レスポンス

| ステータス | 条件 | ボディ |
|-----------|------|--------|
| 204 | 削除成功 | なし |
| 404 | 指定IDが存在しない | なし |

---

### 2.8 DELETE /api/todos - 全件削除

| 項目 | 内容 |
|------|------|
| URL | `/api/todos` |
| メソッド | DELETE |

#### レスポンス

| ステータス | 条件 | ボディ |
|-----------|------|--------|
| 204 | 削除成功 | なし |

---

## 3. 共通レスポンス形式

### 3.1 Todoオブジェクト

| フィールド | 型 | 説明 |
|-----------|-----|------|
| id | Long | 一意識別子 |
| title | String | タイトル |
| description | String | 説明 |
| completed | boolean | 完了フラグ |
| createdAt | String (ISO 8601) | 作成日時 |

---

## 4. Controllerクラス設計

### 4.1 TodoController

**パッケージ**: `com.example.demo`

**アノテーション**: `@RestController`, `@RequestMapping("/api/todos")`

#### メソッド一覧

| メソッド | HTTPメソッド | パス | 説明 |
|---------|-------------|------|------|
| getAllTodos | GET | / | 全件取得（フィルタ対応） |
| getTodoById | GET | /{id} | 単一取得 |
| getStats | GET | /stats | 統計取得 |
| createTodo | POST | / | 新規作成 |
| updateTodo | PUT | /{id} | 更新 |
| toggleComplete | PATCH | /{id}/toggle | 完了切替 |
| deleteTodo | DELETE | /{id} | 単一削除 |
| deleteAllTodos | DELETE | / | 全件削除 |

---

## 改版履歴

| 版数 | 日付 | 変更内容 | 変更者 |
|------|------|----------|--------|
| 1.0 | 2025-12-22 | 初版作成（既存詳細設計書から分離） | - |
