# 要件整理書

## 案件情報

| 項目 | 内容 |
|------|------|
| 案件名 | H2 Database移行 |
| 案件ID | 202512_H2DB移行 |
| 作成日 | 2025-12-22 |
| ステータス | 検討中 |

---

## 1. 案件概要

### 1.1 案件の背景

現在のToDoアプリケーションは、ConcurrentHashMapを使用したインメモリDBで動作している。この方式には以下の課題がある：

- アプリケーション再起動時にデータが消失する
- SQLによるデータ操作ができない
- 将来的なRDBMS移行への準備ができていない

これらの課題を解決するため、軽量なSQLデータベースへの移行を行う。

### 1.2 案件の目的

- **データの永続化**: アプリケーション再起動後もデータを保持する
- **SQL対応**: 標準的なSQLでデータ操作を可能にする
- **軽量性維持**: MySQLなど重量級DBではなく、組み込み型の軽量DBを使用する
- **将来への準備**: 本番環境向けRDBMS移行の基盤を整備する

### 1.3 対象ユーザー

| ユーザー | 利用シーン |
|---------|-----------|
| 開発者 | ローカル開発環境でのデータ永続化 |
| 個人 | 継続的なタスク管理（データ消失なし） |

---

## 2. 要求一覧

### 2.1 ビジネス要求

| ID | 要求 | 優先度 | 理由 |
|----|------|--------|------|
| BR-001 | データを永続化できること | 必須 | 再起動でデータが消えると実用に耐えない |
| BR-002 | SQLでデータ操作できること | 必須 | 標準的な方法でデータ操作したい |
| BR-003 | 軽量なDBを使用すること | 必須 | MySQL等の重量級DBは避けたい |
| BR-004 | 既存機能を維持すること | 必須 | 現在のAPIや画面の動作を壊さない |
| BR-005 | 開発時にDBを確認できること | 希望 | デバッグ・確認が容易であること |

### 2.2 ユーザー要求（ユーザーストーリー）

| ID | ユーザーストーリー | 対応BR | 優先度 |
|----|-------------------|--------|--------|
| US-001 | ユーザーとして、アプリを再起動してもToDoが残っていてほしい。なぜなら、毎回入力し直すのは面倒だから。 | BR-001 | 高 |
| US-002 | 開発者として、SQLでデータを確認・操作したい。なぜなら、デバッグや調査が効率的になるから。 | BR-002, BR-005 | 高 |
| US-003 | 開発者として、追加のインストールなしでDBを使いたい。なぜなら、環境構築を簡略化したいから。 | BR-003 | 高 |

---

## 3. スコープ定義

### 3.1 スコープ内（In Scope）

| カテゴリ | 項目 | 説明 |
|---------|------|------|
| 技術 | H2 Database導入 | 組み込み型SQLデータベース |
| 技術 | Spring Data JPA導入 | Repository層の追加 |
| 技術 | ファイル永続化 | `./data/tododb`にデータ保存 |
| 機能 | H2 Console | ブラウザからDB操作可能 |
| 機能 | 初期データ投入 | 空DB時にサンプルデータ作成 |
| テスト | テストコード修正 | 統合テストへの変換 |

### 3.2 スコープ外（Out of Scope）

| 項目 | 見送り理由 | 将来検討 |
|------|-----------|---------|
| MySQL/PostgreSQL対応 | 軽量性優先のため | 可 |
| マイグレーションツール | 現段階では不要 | 可 |
| 本番環境設定 | 開発環境のみ対象 | 可 |
| 複数DB切り替え | シンプルさ優先 | 可 |

---

## 4. 機能要件

### 4.1 機能一覧

| ID | 機能名 | 概要 | 対応US | 優先度 |
|----|--------|------|--------|--------|
| F-001 | データ永続化 | H2ファイルモードでデータ保存 | US-001 | 必須 |
| F-002 | JPA Repository | Spring Data JPAによるDB操作 | US-002 | 必須 |
| F-003 | H2 Console | `/h2-console`でDB確認 | US-002 | 希望 |
| F-004 | 初期データ投入 | 空DB時にサンプルToDo作成 | - | 希望 |
| F-005 | 自動スキーマ生成 | Hibernateによるテーブル自動作成 | US-003 | 必須 |

### 4.2 変更なし（維持する機能）

| ID | 機能名 | 備考 |
|----|--------|------|
| 既存 | ToDo作成 | APIエンドポイント維持 |
| 既存 | ToDo一覧取得 | APIエンドポイント維持 |
| 既存 | ToDo更新 | APIエンドポイント維持 |
| 既存 | 完了状態切替 | APIエンドポイント維持 |
| 既存 | ToDo削除 | APIエンドポイント維持 |
| 既存 | 統計情報取得 | APIエンドポイント維持 |
| 既存 | フィルタ取得 | APIエンドポイント維持 |
| 既存 | ToDoリスト画面 | 変更なし |

---

## 5. 非機能要件

### 5.1 性能要件

| 項目 | 要件 | 測定方法 |
|------|------|---------|
| API応答時間 | 現状維持（1秒以内） | 開発者ツールで確認 |
| DB接続 | 組み込みのため遅延なし | - |

### 5.2 可用性要件

| 項目 | 要件 |
|------|------|
| データ保持 | アプリ再起動後も保持 |
| ファイル保存先 | `./data/tododb` |

### 5.3 セキュリティ要件

| 項目 | 対応 |
|------|------|
| H2 Console | ローカルアクセスのみ許可 |
| DBパスワード | 開発用のため空文字許容 |

### 5.4 保守性要件

| 項目 | 要件 |
|------|------|
| コード構成 | Repository層の追加 |
| テスト | 統合テストへ変換 |
| 将来拡張 | 他RDBMSへの移行容易性 |

---

## 6. 制約条件

### 6.1 技術制約

| 項目 | 制約 |
|------|------|
| データベース | H2 Database |
| ORM | Spring Data JPA |
| 永続化方式 | ファイルモード |

### 6.2 環境制約

| 項目 | 制約 |
|------|------|
| 動作環境 | ローカル開発環境 |
| データ保存先 | プロジェクトルート/data/ |

---

## 7. 前提条件

| 項目 | 前提 |
|------|------|
| 既存機能 | 現在のToDoアプリが正常動作していること |
| テスト | 既存テストが全て通過していること |

---

## 8. 受入条件

### 8.1 機能面

| 条件 | 確認方法 |
|------|---------|
| アプリ再起動後もデータが保持されること | 再起動テスト |
| H2 Consoleでデータ確認できること | ブラウザアクセス |
| 既存の全API が動作すること | 手動確認・テスト実行 |
| 既存の画面が動作すること | ブラウザ確認 |

### 8.2 非機能面

| 条件 | 確認方法 |
|------|---------|
| テストが全て通過すること | `./mvnw test` |
| 操作がスムーズであること | 体感確認 |

---

## 9. 用語定義

| 用語 | 定義 |
|------|------|
| H2 Database | Java製の組み込み型SQLデータベース |
| Spring Data JPA | SpringによるJPA実装のサポートライブラリ |
| Repository | データアクセス層を抽象化するインターフェース |
| ファイルモード | H2のデータをファイルに永続化する動作モード |
| インメモリ | データをメモリ上にのみ保持する方式 |

---

## 10. 関連ドキュメント

| ドキュメント | 説明 |
|-------------|------|
| [implementation-plan.md](./implementation-plan.md) | 実装計画（作業想定） |
| [../202512_初期構築/requirements.md](../202512_初期構築/requirements.md) | 初期構築の要件定義書 |

---

## 改版履歴

| 版数 | 日付 | 変更内容 | 変更者 |
|------|------|----------|--------|
| 1.0 | 2025-12-22 | 初版作成 | - |
