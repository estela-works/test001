# アーキテクチャ仕様書

> **ドキュメント種別**: 最新仕様（継続的にメンテナンス）

## 1. ドキュメント情報

| 項目 | 内容 |
|------|------|
| プロジェクト名 | Simple Spring Boot ToDo Application |
| 最終更新日 | 2025-12-22 |

---

## 2. 技術スタック

### 2.1 採用技術一覧

| レイヤー | 技術 | バージョン | 選定理由 |
|---------|------|-----------|----------|
| 言語 | Java | 21 | LTS版、最新機能が利用可能 |
| フレームワーク | Spring Boot | 3.2.0 | 迅速な開発、豊富なエコシステム |
| ビルド | Maven | 3.x | 標準的なビルドツール |
| Webサーバー | 組み込みTomcat | - | Spring Boot標準、設定不要 |
| フロントエンド | HTML/CSS/JS | - | シンプル、フレームワーク不要 |
| テスト | JUnit 5 + AssertJ | - | Spring Boot標準テストスタック |

### 2.2 依存ライブラリ

| ライブラリ | 用途 |
|-----------|------|
| spring-boot-starter-web | Web機能、REST API |
| spring-boot-starter-test | テスト機能 |

---

## 3. システム構成

### 3.1 全体構成

```
┌─────────────────────────────────────────────────────────────┐
│                        クライアント                          │
│                    （Webブラウザ）                           │
└─────────────────────────────────────────────────────────────┘
                              │
                              │ HTTP
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    Spring Boot Application                   │
│  ┌─────────────────────────────────────────────────────┐   │
│  │              静的リソース（HTML/CSS/JS）              │   │
│  └─────────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                    REST API                          │   │
│  │              （/api/todos エンドポイント）             │   │
│  └─────────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                  メモリデータストア                    │   │
│  │               （ConcurrentHashMap）                   │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 通信フロー

```
ブラウザ  ──GET /todos.html──▶  静的リソース
          ◀──HTML/CSS/JS────

ブラウザ  ──GET /api/todos──▶  TodoController ──▶ TodoService ──▶ データ
          ◀──JSON──────────   ◀───────────────  ◀─────────────
```

---

## 4. アプリケーションアーキテクチャ

### 4.1 レイヤー構成

```
┌─────────────────────────────────────────────────────────────┐
│                    Presentation Layer                        │
│                     （Controller層）                          │
│  ┌─────────────────┐  ┌─────────────────┐                  │
│  │ HelloController │  │ TodoController  │                  │
│  │   （ホーム）     │  │  （REST API）   │                  │
│  └─────────────────┘  └─────────────────┘                  │
│            責務: リクエスト受付、レスポンス返却、バリデーション  │
├─────────────────────────────────────────────────────────────┤
│                     Business Layer                           │
│                     （Service層）                            │
│              ┌─────────────────┐                            │
│              │   TodoService   │                            │
│              └─────────────────┘                            │
│            責務: ビジネスロジック、データ操作、統計計算         │
├─────────────────────────────────────────────────────────────┤
│                      Domain Layer                            │
│                     （Entity層）                             │
│              ┌─────────────────┐                            │
│              │      Todo       │                            │
│              └─────────────────┘                            │
│            責務: データ構造定義                               │
└─────────────────────────────────────────────────────────────┘
```

### 4.2 レイヤー間の依存関係

| 依存元 | 依存先 | 依存方法 |
|--------|--------|----------|
| Controller | Service | @Autowired（DI） |
| Service | Entity | 直接利用 |
| Controller | Entity | 直接利用（リクエスト/レスポンス） |

### 4.3 各レイヤーの責務

| レイヤー | 責務 | やること | やらないこと |
|---------|------|----------|-------------|
| Controller | API提供 | リクエスト受付、バリデーション、レスポンス返却 | ビジネスロジック |
| Service | ビジネスロジック | データ操作、業務ルール適用、統計計算 | HTTPハンドリング |
| Entity | データ構造 | 属性定義、getter/setter | ロジック |

---

## 5. クラス構成

### 5.1 クラス一覧

```
com.example.demo/
├── SimpleSpringApplication.java   # エントリーポイント
├── HelloController.java           # ホームページ用Controller
├── TodoController.java            # ToDo API用Controller
├── TodoService.java               # ビジネスロジック
└── Todo.java                      # エンティティ
```

### 5.2 クラス図

```
┌────────────────────────┐
│ SimpleSpringApplication│
│ (@SpringBootApplication)│
└────────────────────────┘

┌────────────────────────┐       ┌────────────────────────┐
│    HelloController     │       │    TodoController      │
│    (@Controller)       │       │    (@RestController)   │
│                        │       │                        │
│ + home(): String       │       │ + getAllTodos()        │
│ + message(): Map       │       │ + getTodoById()        │
└────────────────────────┘       │ + createTodo()         │
                                 │ + updateTodo()         │
                                 │ + toggleComplete()     │
                                 │ + deleteTodo()         │
                                 │ + deleteAllTodos()     │
                                 │ + getStats()           │
                                 └───────────┬────────────┘
                                             │ @Autowired
                                             ▼
                                 ┌────────────────────────┐
                                 │     TodoService        │
                                 │     (@Service)         │
                                 │                        │
                                 │ - todos: Map<Long,Todo>│
                                 │ - idGenerator: AtomicLong│
                                 │                        │
                                 │ + getAllTodos()        │
                                 │ + getTodoById()        │
                                 │ + createTodo()         │
                                 │ + updateTodo()         │
                                 │ + toggleComplete()     │
                                 │ + deleteTodo()         │
                                 │ + deleteAllTodos()     │
                                 │ + getTotalCount()      │
                                 │ + getCompletedCount()  │
                                 │ + getPendingCount()    │
                                 └───────────┬────────────┘
                                             │ uses
                                             ▼
                                 ┌────────────────────────┐
                                 │         Todo           │
                                 │       (Entity)         │
                                 │                        │
                                 │ - id: Long             │
                                 │ - title: String        │
                                 │ - description: String  │
                                 │ - completed: boolean   │
                                 │ - createdAt: LocalDateTime│
                                 └────────────────────────┘
```

---

## 6. データ管理

### 6.1 データストア

| 項目 | 内容 |
|------|------|
| 方式 | インメモリ |
| 実装 | ConcurrentHashMap<Long, Todo> |
| ID採番 | AtomicLong（連番） |
| 永続化 | なし（再起動でリセット） |

### 6.2 スレッドセーフティ

| 対策 | 説明 |
|------|------|
| ConcurrentHashMap | 複数スレッドからの同時アクセスに対応 |
| AtomicLong | ID採番の原子性を保証 |

---

## 7. フロントエンド構成

### 7.1 ファイル構成

```
src/main/resources/static/
└── todos.html          # ToDoリスト画面（HTML/CSS/JS一体型）
```

### 7.2 技術選定

| 項目 | 採用 | 理由 |
|------|------|------|
| マークアップ | HTML5 | 標準技術 |
| スタイル | インラインCSS | ファイル分割不要でシンプル |
| ロジック | Vanilla JavaScript | フレームワーク不要でシンプル |
| API通信 | Fetch API | ブラウザ標準、非同期対応 |

---

## 8. 設計原則

### 8.1 採用している原則

| 原則 | 適用箇所 |
|------|----------|
| 単一責任 | Controller/Service/Entity の分離 |
| 依存性注入 | @Autowired によるDI |
| 関心の分離 | 層ごとの責務分離 |

### 8.2 シンプルさの優先

本プロジェクトではシンプルさを優先し、以下は採用していない:

| 不採用 | 理由 |
|--------|------|
| Repository層 | DBがないため不要 |
| DTO | Entity直接利用で十分 |
| 例外ハンドラ | 基本的なエラー処理で十分 |
| ロギング | デモ用途では不要 |

---

## 9. 拡張ポイント

将来の機能追加時の拡張ポイント:

| 拡張 | 対応方法 |
|------|----------|
| DB永続化 | Repository層追加、JPA導入 |
| ユーザー認証 | Spring Security導入 |
| バリデーション強化 | Bean Validation導入 |
| API仕様書 | OpenAPI/Swagger導入 |
| フロントエンド高度化 | React/Vue等のSPA化 |

---

## 更新履歴

| 日付 | 変更内容 | 関連案件 |
|------|----------|----------|
| 2025-12-22 | 初版作成（初期構築） | - |
