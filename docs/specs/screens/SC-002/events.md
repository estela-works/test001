# SC-002: ToDoリスト画面 - イベント詳細

> **ドキュメント種別**: 最新仕様（継続的にメンテナンス）

## 1. イベント一覧

| イベントID | イベント名 | トリガー | 処理概要 |
|-----------|-----------|---------|---------|
| EV-002-01 | 初期読込 | ページロード | ToDo一覧・統計を取得して表示 |
| EV-002-02 | 統計更新 | データ変更後 | 統計情報を再取得して表示 |
| EV-002-03 | ToDo追加 | 追加ボタン/Enter | 新規ToDoを作成 |
| EV-002-04 | フィルタ切替 | フィルタボタン | 表示するToDoをフィルタ |
| EV-002-05 | 完了状態切替 | 完了/未完了ボタン | 完了状態をトグル |
| EV-002-06 | ToDo削除 | 削除ボタン | ToDoを削除 |
| EV-002-07 | ホーム遷移 | フッターリンク | ホーム画面へ遷移 |

---

## 2. イベント詳細

### 2.1 EV-002-01: 初期読込

| 項目 | 内容 |
|------|------|
| イベントID | EV-002-01 |
| イベント名 | 初期読込 |
| トリガー | DOMContentLoaded（ページロード完了時） |

#### 処理フロー

```
1. ページロード完了
2. loadTodos() 呼び出し
   └→ GET /api/todos
   └→ レスポンスを受け取りカード描画
3. loadStats() 呼び出し
   └→ GET /api/todos/stats
   └→ 統計エリア更新
```

#### 使用API

| API | メソッド | リクエスト | レスポンス |
|-----|---------|-----------|-----------|
| /api/todos | GET | なし | ToDo配列 |
| /api/todos/stats | GET | なし | { total, completed, pending } |

#### エラー処理

| エラー | 対応 |
|--------|------|
| 通信失敗 | エラーメッセージを表示（5秒後消去） |

---

### 2.2 EV-002-02: 統計更新

| 項目 | 内容 |
|------|------|
| イベントID | EV-002-02 |
| イベント名 | 統計更新 |
| トリガー | ToDo追加/削除/状態変更後 |

#### 処理フロー

```
1. データ変更操作完了
2. loadStats() 呼び出し
   └→ GET /api/todos/stats
   └→ 統計エリア更新（総数/完了/未完了）
```

#### 使用API

| API | メソッド | リクエスト | レスポンス |
|-----|---------|-----------|-----------|
| /api/todos/stats | GET | なし | { total, completed, pending } |

---

### 2.3 EV-002-03: ToDo追加

| 項目 | 内容 |
|------|------|
| イベントID | EV-002-03 |
| イベント名 | ToDo追加 |
| トリガー | 追加ボタンクリック / Enterキー押下 |

#### 処理フロー

```
1. フォーム入力値を取得
2. バリデーション
   ├→ タイトル空 → 処理中止
   └→ タイトルあり → 続行
3. POST /api/todos
   Body: { title, description }
4. 成功時
   ├→ フォームクリア
   ├→ loadTodos() でリスト再取得
   └→ loadStats() で統計更新
```

#### 入力データ

| フィールド | 必須 | 検証 |
|-----------|------|------|
| title | 必須 | 空文字チェック |
| description | 任意 | - |

#### 使用API

| API | メソッド | リクエスト | レスポンス |
|-----|---------|-----------|-----------|
| /api/todos | POST | { title, description } | 作成されたToDo |

#### エラー処理

| エラー | 対応 |
|--------|------|
| タイトル空 | 処理中止（API呼び出しなし） |
| 400 Bad Request | エラーメッセージ表示 |
| 通信失敗 | エラーメッセージ表示 |

---

### 2.4 EV-002-04: フィルタ切替

| 項目 | 内容 |
|------|------|
| イベントID | EV-002-04 |
| イベント名 | フィルタ切替 |
| トリガー | フィルタボタン（すべて/未完了/完了済み）クリック |

#### 処理フロー

```
1. フィルタボタンクリック
2. ボタンのアクティブ状態を更新
3. フィルタ種別に応じてAPI呼び出し
   ├→ すべて: GET /api/todos
   ├→ 未完了: GET /api/todos?completed=false
   └→ 完了済み: GET /api/todos?completed=true
4. レスポンスでカードを再描画
```

#### フィルタ種別

| ボタン | APIパラメータ |
|--------|--------------|
| すべて | なし |
| 未完了 | ?completed=false |
| 完了済み | ?completed=true |

#### 使用API

| API | メソッド | リクエスト | レスポンス |
|-----|---------|-----------|-----------|
| /api/todos | GET | クエリパラメータ(optional) | ToDo配列 |

---

### 2.5 EV-002-05: 完了状態切替

| 項目 | 内容 |
|------|------|
| イベントID | EV-002-05 |
| イベント名 | 完了状態切替 |
| トリガー | ToDoカードの「完了にする」/「未完了にする」ボタン |

#### 処理フロー

```
1. 完了/未完了ボタンクリック
2. 対象ToDoのIDを取得
3. PATCH /api/todos/{id}/toggle
4. 成功時
   ├→ 現在のフィルタ状態を維持してリスト再取得
   └→ loadStats() で統計更新
```

#### 使用API

| API | メソッド | リクエスト | レスポンス |
|-----|---------|-----------|-----------|
| /api/todos/{id}/toggle | PATCH | なし | 更新されたToDo |

#### UI変更

| 変更前 | 変更後 |
|--------|--------|
| 未完了（通常表示） | 完了（グレー背景、取消線、透明度70%） |
| 完了 | 未完了（通常表示） |

---

### 2.6 EV-002-06: ToDo削除

| 項目 | 内容 |
|------|------|
| イベントID | EV-002-06 |
| イベント名 | ToDo削除 |
| トリガー | ToDoカードの「削除」ボタン |

#### 処理フロー

```
1. 削除ボタンクリック
2. 確認ダイアログ表示
   └→「このToDoを削除しますか？」
3. ユーザー応答
   ├→ キャンセル → 処理中止
   └→ OK → 続行
4. DELETE /api/todos/{id}
5. 成功時
   ├→ 現在のフィルタ状態を維持してリスト再取得
   └→ loadStats() で統計更新
```

#### 確認ダイアログ

| 項目 | 内容 |
|------|------|
| メッセージ | 「このToDoを削除しますか？」 |
| OK | 削除実行 |
| キャンセル | 処理中止 |

#### 使用API

| API | メソッド | リクエスト | レスポンス |
|-----|---------|-----------|-----------|
| /api/todos/{id} | DELETE | なし | 削除されたToDo |

---

### 2.7 EV-002-07: ホーム遷移

| 項目 | 内容 |
|------|------|
| イベントID | EV-002-07 |
| イベント名 | ホーム遷移 |
| トリガー | フッターの「← ホームに戻る」リンク |

#### 処理フロー

```
1. リンククリック
2. location.href = "/" でホーム画面へ遷移
```

#### 遷移先

| 遷移先 | パス |
|--------|------|
| SC-001: ホーム画面 | / |

---

## 3. 共通処理

### 3.1 エラーメッセージ表示

| 項目 | 内容 |
|------|------|
| 表示位置 | 画面上部（統計エリア下） |
| スタイル | 赤背景、白文字 |
| 自動消去 | 5秒後 |

### 3.2 ローディング表示

| 項目 | 内容 |
|------|------|
| 表示位置 | ToDoリストエリア |
| 表示テキスト | 「読み込み中...」 |
| 表示タイミング | API通信中 |

---

## 更新履歴

| 日付 | 変更内容 | 関連案件 |
|------|----------|----------|
| 2025-12-22 | イベント詳細として分離・新規作成 | - |
