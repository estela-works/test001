# テストケース集積

> **ドキュメント種別**: 最新仕様（継続的にメンテナンス）

## 1. 概要

| 項目 | 内容 |
|------|------|
| テストフレームワーク | JUnit 5 + AssertJ |
| APIテストユーティリティ | Spring MockMvc（コントローラ/APIテストに使用） |
| Mapperテスト | @MybatisTest |
| 統合テスト | @SpringBootTest |
| 最終更新日 | 2025-12-22 |

---

## 2. テストケース統計

### 2.1 サマリー

| 対象クラス | 正常系 | 異常系 | 境界値 | 合計 |
|-----------|--------|--------|--------|------|
| TodoMapper | 12 | 1 | 2 | 15 |
| TodoService | 23 | 5 | 10 | 38 |
| TodoController | 12 | 3 | 0 | 15 |
| **合計** | **47** | **9** | **12** | **68** |

---

## 3. TodoMapper テストケース

### 3.1 selectAll() - 全件取得

| ID | テストケース | 分類 | 前提条件 | 期待結果 | 追加案件 |
|----|-------------|------|----------|----------|----------|
| M-001 | 全件取得（ソート確認） | 正常系 | 3件のテストデータ | 作成日時順で3件返却 | 202512_H2DB移行 |

### 3.2 selectById(Long id) - ID指定取得

| ID | テストケース | 分類 | 前提条件 | 期待結果 | 追加案件 |
|----|-------------|------|----------|----------|----------|
| M-002 | 存在するIDで取得 | 正常系 | ID=1が存在 | 該当Todoが返却 | 202512_H2DB移行 |
| M-003 | 存在しないIDで取得 | 異常系 | ID=999は存在しない | nullが返却 | 202512_H2DB移行 |

### 3.3 selectByCompleted(boolean) - 完了状態フィルタ

| ID | テストケース | 分類 | 前提条件 | 期待結果 | 追加案件 |
|----|-------------|------|----------|----------|----------|
| M-004 | 未完了のみ取得 | 正常系 | 2件未完了、1件完了 | 2件返却 | 202512_H2DB移行 |
| M-005 | 完了のみ取得 | 正常系 | 2件未完了、1件完了 | 1件返却 | 202512_H2DB移行 |

### 3.4 insert(Todo) - 新規登録

| ID | テストケース | 分類 | 前提条件 | 期待結果 | 追加案件 |
|----|-------------|------|----------|----------|----------|
| M-006 | 新規登録（ID自動採番） | 正常系 | 新規Todo | IDが自動設定される | 202512_H2DB移行 |
| M-007 | 登録後の件数確認 | 正常系 | 3件→新規登録 | 4件に増加 | 202512_H2DB移行 |

### 3.5 update(Todo) - 更新

| ID | テストケース | 分類 | 前提条件 | 期待結果 | 追加案件 |
|----|-------------|------|----------|----------|----------|
| M-008 | 既存Todoを更新 | 正常系 | ID=1が存在 | 各フィールドが更新される | 202512_H2DB移行 |

### 3.6 deleteById(Long id) - ID指定削除

| ID | テストケース | 分類 | 前提条件 | 期待結果 | 追加案件 |
|----|-------------|------|----------|----------|----------|
| M-009 | 存在するIDを削除 | 正常系 | ID=1が存在、3件 | 2件に減少 | 202512_H2DB移行 |

### 3.7 deleteAll() - 全件削除

| ID | テストケース | 分類 | 前提条件 | 期待結果 | 追加案件 |
|----|-------------|------|----------|----------|----------|
| M-010 | 全件削除 | 正常系 | 3件存在 | 0件になる | 202512_H2DB移行 |
| M-011 | 空の状態で全削除 | 境界値 | 0件 | エラーなく完了 | 202512_H2DB移行 |

### 3.8 count() - 件数取得

| ID | テストケース | 分類 | 前提条件 | 期待結果 | 追加案件 |
|----|-------------|------|----------|----------|----------|
| M-012 | 初期件数取得 | 正常系 | 3件存在 | 3が返却 | 202512_H2DB移行 |
| M-013 | 全削除後の件数 | 境界値 | 0件 | 0が返却 | 202512_H2DB移行 |

### 3.9 countByCompleted(boolean) - 完了状態別件数

| ID | テストケース | 分類 | 前提条件 | 期待結果 | 追加案件 |
|----|-------------|------|----------|----------|----------|
| M-014 | 完了件数取得 | 正常系 | 1件完了 | 1が返却 | 202512_H2DB移行 |
| M-015 | 未完了件数取得 | 正常系 | 2件未完了 | 2が返却 | 202512_H2DB移行 |

---

## 4. TodoService テストケース

### 4.1 getAllTodos() - 全ToDo取得

| ID | テストケース | 分類 | 前提条件 | 期待結果 | 追加案件 |
|----|-------------|------|----------|----------|----------|
| GT-001 | 初期状態で取得 | 正常系 | サンプルデータ3件が存在 | 3件が作成日時順で返却 | 初期構築 |
| GT-002 | 全削除後に取得 | 境界値 | 全ToDoを削除済み | 空のリストが返却 | 初期構築 |
| GT-003 | 新規追加後に取得 | 正常系 | サンプル3件 + 新規1件 | 4件が作成日時順で返却 | 初期構築 |

### 4.2 getTodosByCompleted(boolean completed) - 完了状態でフィルタリング

| ID | テストケース | 分類 | 前提条件 | 期待結果 | 追加案件 |
|----|-------------|------|----------|----------|----------|
| GC-001 | completed=falseでフィルタ | 正常系 | 1件を完了状態に変更 | 未完了のToDoのみ返却（2件） | 初期構築 |
| GC-002 | completed=trueでフィルタ | 正常系 | 2件を完了状態に変更 | 完了済みのToDoのみ返却（2件） | 初期構築 |
| GC-003 | 該当なしの場合 | 境界値 | 全て未完了 | 空のリストが返却 | 初期構築 |
| GC-004 | 結果が作成日時順でソート | 正常系 | サンプルデータ3件が存在 | ソート順が正しい | 初期構築 |

### 4.3 getTodoById(Long id) - ID指定で取得

| ID | テストケース | 分類 | 前提条件 | 期待結果 | 追加案件 |
|----|-------------|------|----------|----------|----------|
| GI-001 | 存在するIDで取得 | 正常系 | ID=1が存在 | 該当のTodoが返却 | 初期構築 |
| GI-002 | 存在しないIDで取得 | 異常系 | ID=999は存在しない | nullが返却 | 初期構築 |
| GI-003 | nullのIDで取得 | 異常系 | - | NullPointerException | 初期構築 |

### 4.4 createTodo(Todo todo) - 新規作成

| ID | テストケース | 分類 | 前提条件 | 期待結果 | 追加案件 |
|----|-------------|------|----------|----------|----------|
| CT-001 | 正常なToDoを作成 | 正常系 | title, descriptionを設定 | IDが自動採番（4）され返却 | 初期構築 |
| CT-002 | 連続作成時のID採番 | 正常系 | 3件連続で作成 | IDが連番（4, 5, 6） | 初期構築 |
| CT-003 | null値のToDo作成 | 境界値 | フィールドがnull | nullのまま作成 | 初期構築 |

### 4.5 updateTodo(Long id, Todo updatedTodo) - 更新

| ID | テストケース | 分類 | 前提条件 | 期待結果 | 追加案件 |
|----|-------------|------|----------|----------|----------|
| UT-001 | 存在するToDoを更新 | 正常系 | ID=1が存在 | 更新されたTodoが返却 | 初期構築 |
| UT-002 | 全フィールドを更新 | 正常系 | ID=1が存在 | 全フィールドが正しく更新 | 初期構築 |
| UT-003 | 存在しないIDで更新 | 異常系 | ID=999は存在しない | nullが返却 | 初期構築 |
| UT-004 | createdAtが保持される | 境界値 | ID=1が存在 | createdAtは元の値を維持 | 初期構築 |

### 4.6 toggleComplete(Long id) - 完了状態切り替え

| ID | テストケース | 分類 | 前提条件 | 期待結果 | 追加案件 |
|----|-------------|------|----------|----------|----------|
| TC-001 | 未完了→完了に切り替え | 正常系 | ID=1が未完了 | completed=true | 初期構築 |
| TC-002 | 完了→未完了に切り替え | 正常系 | ID=1が完了状態 | completed=false | 初期構築 |
| TC-003 | 存在しないIDで切り替え | 異常系 | ID=999は存在しない | nullが返却 | 初期構築 |
| TC-004 | 2回連続切り替え | 境界値 | ID=1が未完了 | 元の状態に戻る | 初期構築 |

### 4.7 deleteTodo(Long id) - 削除

| ID | テストケース | 分類 | 前提条件 | 期待結果 | 追加案件 |
|----|-------------|------|----------|----------|----------|
| DT-001 | 存在するToDoを削除 | 正常系 | ID=1が存在、総数3 | 削除されたTodoが返却、総数が2 | 初期構築 |
| DT-002 | 存在しないIDで削除 | 異常系 | ID=999は存在しない | nullが返却 | 初期構築 |
| DT-003 | 削除後に同じIDで取得 | 正常系 | ID=1を削除済み | nullが返却 | 初期構築 |

### 4.8 deleteAllTodos() - 全削除

| ID | テストケース | 分類 | 前提条件 | 期待結果 | 追加案件 |
|----|-------------|------|----------|----------|----------|
| DA-001 | 全ToDoを削除 | 正常系 | 3件が存在 | 総数が0 | 初期構築 |
| DA-002 | 空の状態で全削除 | 境界値 | 0件 | エラーなく完了、総数は0 | 初期構築 |

### 4.9 getTotalCount() - 総数取得

| ID | テストケース | 分類 | 前提条件 | 期待結果 | 追加案件 |
|----|-------------|------|----------|----------|----------|
| CN-001 | 初期状態で取得 | 正常系 | サンプル3件 | 3が返却 | 初期構築 |
| CN-002 | 追加後に取得 | 正常系 | 1件追加後 | 4が返却 | 初期構築 |
| CN-003 | 削除後に取得 | 正常系 | 1件削除後 | 2が返却 | 初期構築 |
| CN-004 | 全削除後に取得 | 境界値 | 全削除後 | 0が返却 | 初期構築 |

### 4.10 getCompletedCount() - 完了数取得

| ID | テストケース | 分類 | 前提条件 | 期待結果 | 追加案件 |
|----|-------------|------|----------|----------|----------|
| CC-001 | 初期状態（全て未完了） | 正常系 | サンプル3件（全て未完了） | 0が返却 | 初期構築 |
| CC-002 | 1件完了後 | 正常系 | 1件を完了に変更 | 1が返却 | 初期構築 |
| CC-003 | 全件完了後 | 正常系 | 全3件を完了に変更 | 3が返却 | 初期構築 |
| CC-004 | 全削除後 | 境界値 | 全削除後 | 0が返却 | 初期構築 |

### 4.11 getPendingCount() - 未完了数取得

| ID | テストケース | 分類 | 前提条件 | 期待結果 | 追加案件 |
|----|-------------|------|----------|----------|----------|
| PC-001 | 初期状態（全て未完了） | 正常系 | サンプル3件（全て未完了） | 3が返却 | 初期構築 |
| PC-002 | 1件完了後 | 正常系 | 1件を完了に変更 | 2が返却 | 初期構築 |
| PC-003 | 全件完了後 | 境界値 | 全3件を完了に変更 | 0が返却 | 初期構築 |
| PC-004 | 計算結果の検証 | 正常系 | 1件を完了に変更 | total - completed と一致 | 初期構築 |

---

## 5. TodoController テストケース

### 5.1 GET /api/todos - 全件取得

| ID | テストケース | 分類 | 前提条件 | 期待結果 | 追加案件 |
|----|-------------|------|----------|----------|----------|
| A-001 | 全件取得 | 正常系 | 3件存在 | 200 OK、3件のJSON配列 | 202512_H2DB移行 |
| A-002 | completed=falseでフィルタ | 正常系 | 2件未完了 | 200 OK、2件返却 | 202512_H2DB移行 |
| A-003 | completed=trueでフィルタ | 正常系 | 1件完了 | 200 OK、1件返却 | 202512_H2DB移行 |

### 5.2 GET /api/todos/{id} - ID指定取得

| ID | テストケース | 分類 | 前提条件 | 期待結果 | 追加案件 |
|----|-------------|------|----------|----------|----------|
| A-004 | 存在するID | 正常系 | ID=1が存在 | 200 OK、該当Todo | 202512_H2DB移行 |
| A-005 | 存在しないID | 異常系 | ID=999なし | 404 Not Found | 202512_H2DB移行 |

### 5.3 POST /api/todos - 新規作成

| ID | テストケース | 分類 | 前提条件 | 期待結果 | 追加案件 |
|----|-------------|------|----------|----------|----------|
| A-006 | 正常な新規作成 | 正常系 | 有効なJSON | 201 Created、ID付きTodo | 202512_H2DB移行 |
| A-007 | titleなしで作成 | 異常系 | titleがnull | 400 Bad Request | 202512_H2DB移行 |

### 5.4 PUT /api/todos/{id} - 更新

| ID | テストケース | 分類 | 前提条件 | 期待結果 | 追加案件 |
|----|-------------|------|----------|----------|----------|
| A-008 | 存在するTodoを更新 | 正常系 | ID=1が存在 | 200 OK、更新後Todo | 202512_H2DB移行 |
| A-009 | 存在しないIDで更新 | 異常系 | ID=999なし | 404 Not Found | 202512_H2DB移行 |

### 5.5 PATCH /api/todos/{id}/toggle - 完了切替

| ID | テストケース | 分類 | 前提条件 | 期待結果 | 追加案件 |
|----|-------------|------|----------|----------|----------|
| A-010 | 完了状態をトグル | 正常系 | ID=1が未完了 | 200 OK、completed=true | 202512_H2DB移行 |

### 5.6 DELETE /api/todos/{id} - 削除

| ID | テストケース | 分類 | 前提条件 | 期待結果 | 追加案件 |
|----|-------------|------|----------|----------|----------|
| A-011 | 存在するTodoを削除 | 正常系 | ID=1が存在 | 200 OK、削除されたTodo | 202512_H2DB移行 |

### 5.7 DELETE /api/todos - 全件削除

| ID | テストケース | 分類 | 前提条件 | 期待結果 | 追加案件 |
|----|-------------|------|----------|----------|----------|
| A-012 | 全件削除 | 正常系 | 3件存在 | 204 No Content | 202512_H2DB移行 |

### 5.8 GET /api/todos/stats - 統計取得

| ID | テストケース | 分類 | 前提条件 | 期待結果 | 追加案件 |
|----|-------------|------|----------|----------|----------|
| A-013 | 初期状態の統計 | 正常系 | 3件未完了 | total=3, completed=0, pending=3 | 202512_H2DB移行 |
| A-014 | 1件完了後の統計 | 正常系 | 1件完了 | total=3, completed=1, pending=2 | 202512_H2DB移行 |
| A-015 | 全件完了後の統計 | 正常系 | 3件完了 | total=3, completed=3, pending=0 | 202512_H2DB移行 |

---

## 6. テスト実行方法

```bash
# 全テスト実行
./mvnw test

# 特定クラスのテスト実行
./mvnw test -Dtest=TodoMapperTest
./mvnw test -Dtest=TodoServiceTest
./mvnw test -Dtest=TodoControllerTest

# 特定メソッドのテスト実行
./mvnw test -Dtest=TodoServiceTest#getAllTodos*
```

---

## 7. テスト設定

### 7.1 テストプロファイル

| 設定ファイル | 用途 |
|-------------|------|
| application-test.properties | テスト用H2インメモリDB設定 |

### 7.2 テストアノテーション

| アノテーション | 用途 | 適用クラス |
|--------------|------|-----------|
| @MybatisTest | Mapper単体テスト | TodoMapperTest |
| @SpringBootTest | 統合テスト | TodoServiceTest |
| @SpringBootTest + @AutoConfigureMockMvc | APIテスト | TodoControllerTest |
| @ActiveProfiles("test") | テストプロファイル有効化 | 全テストクラス |
| @Transactional | テスト後ロールバック | 全テストクラス |

---

## 更新履歴

| 日付 | 変更内容 | 関連案件 |
|------|----------|----------|
| 2025-12-22 | 初版作成（TodoService: 38ケース） | 初期構築 |
| 2025-12-22 | Mapper・Controllerテスト追加（計68ケース） | 202512_H2DB移行 |
