# ロジック一覧

> **ドキュメント種別**: 最新仕様（継続的にメンテナンス）

## 1. 概要

| 項目 | 内容 |
|------|------|
| 対象 | ビジネスロジック、バリデーション、計算ロジック |
| 最終更新日 | 2025-12-22 |

---

## 2. ビジネスロジック一覧

### 2.1 ToDo管理ロジック

| ID | ロジック名 | 概要 | 適用箇所 | 追加案件 |
|----|-----------|------|----------|----------|
| BL-001 | ID自動採番 | ToDoの作成時にAtomicLongで連番IDを付与 | TodoService.createTodo | 初期構築 |
| BL-002 | 作成日時自動設定 | ToDo作成時に現在日時を自動設定 | Todo.constructor | 初期構築 |
| BL-003 | 完了状態トグル | completedフラグを反転させる | TodoService.toggleComplete | 初期構築 |
| BL-004 | 更新時のcreatedAt保持 | 更新時に作成日時は変更しない | TodoService.updateTodo | 初期構築 |

---

### 2.2 統計計算ロジック

| ID | ロジック名 | 概要 | 適用箇所 | 追加案件 |
|----|-----------|------|----------|----------|
| CL-001 | 総数カウント | Map.size()で総数を取得 | TodoService.getTotalCount | 初期構築 |
| CL-002 | 完了数カウント | completed=trueでフィルタしてカウント | TodoService.getCompletedCount | 初期構築 |
| CL-003 | 未完了数カウント | 総数 - 完了数 で計算 | TodoService.getPendingCount | 初期構築 |

---

### 2.3 ソート・フィルタロジック

| ID | ロジック名 | 概要 | 適用箇所 | 追加案件 |
|----|-----------|------|----------|----------|
| SL-001 | 作成日時順ソート | createdAtで昇順ソート | TodoService.getAllTodos | 初期構築 |
| SL-002 | 完了状態フィルタ | completedパラメータでフィルタリング | TodoService.getTodosByCompleted | 初期構築 |

---

## 3. バリデーション一覧

| ID | 項目 | ルール | エラー条件 | エラーレスポンス | 適用箇所 | 追加案件 |
|----|------|--------|-----------|-----------------|----------|----------|
| VL-001 | title | 必須チェック | null または 空文字 | 400 Bad Request | TodoController.createTodo | 初期構築 |

---

## 4. ロジック詳細

### 4.1 BL-001: ID自動採番

**概要**: ToDoの作成時に一意のIDを自動で付与する

**実装詳細**:
```
1. AtomicLong.getAndIncrement() でIDを取得
2. 取得したIDをTodo.setId() で設定
3. IDは1から開始し、連番で採番
```

**スレッドセーフティ**: AtomicLongにより保証

---

### 4.2 BL-003: 完了状態トグル

**概要**: ToDoの完了状態を反転させる

**実装詳細**:
```
1. 対象ToDoを取得
2. todo.setCompleted(!todo.isCompleted()) で反転
3. 更新後のToDoを返却
```

**状態遷移**:
- false → true（未完了 → 完了）
- true → false（完了 → 未完了）

---

### 4.3 CL-003: 未完了数カウント

**概要**: 未完了のToDo数を計算

**計算式**:
```
未完了数 = getTotalCount() - getCompletedCount()
```

**理由**: 直接フィルタするより効率的（既存メソッドの再利用）

---

## 更新履歴

| 日付 | 変更内容 | 関連案件 |
|------|----------|----------|
| 2025-12-22 | 初版作成 | 初期構築 |
