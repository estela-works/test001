# API-USER-004: ユーザー削除

> **ドキュメント種別**: 最新仕様（継続的にメンテナンス）

## 1. 基本情報

| 項目 | 内容 |
|------|------|
| API ID | API-USER-004 |
| メソッド | DELETE |
| パス | /api/users/{id} |
| 機能 | 指定ユーザーを削除（関連ToDoの担当者はNULLに設定） |
| 認証 | 不要 |

---

## 2. 利用案件

| 案件 | 日付 | 変更内容 |
|------|------|----------|
| 20251204_担当者機能追加 | 2025-12-04 | 新規作成 |

---

## 3. 参照システム

### 3.1 画面

| 画面ID | 画面名 | 利用イベント | 用途 |
|--------|--------|-------------|------|
| - | - | - | 現在画面からの直接利用なし（管理機能未実装） |

### 3.2 外部システム

| システム | 用途 |
|---------|------|
| - | 現在なし |

**注意**: このAPIは現在、直接APIを叩くか、テストデータ削除時に使用される。

---

## 4. リクエスト

### 4.1 パスパラメータ

| パラメータ | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| id | Long | 必須 | ユーザーID |

### 4.2 クエリパラメータ

なし

### 4.3 リクエストボディ

なし

---

## 5. レスポンス

### 5.1 ステータスコード

| コード | 条件 |
|--------|------|
| 204 | 削除成功（No Content） |
| 404 | 指定IDが存在しない |

### 5.2 レスポンスボディ

なし

---

## 6. 処理フロー

```
1. リクエスト受信（パスパラメータ id 取得）
   │
2. UserMapper.findById(id) で存在確認
   │  └─ 存在しない → 404エラー
   │
3. TodoMapper.clearAssigneeByUserId(id) 呼び出し
   │  └─ 該当ユーザーが担当のToDoの assigneeId を NULL に設定
   │
4. UserMapper.deleteById(id) 呼び出し
   │
5. レスポンス返却（204 No Content）
```

---

## 7. エラー処理

| ケース | HTTPステータス | エラーメッセージ |
|--------|---------------|-----------------|
| 指定IDが存在しない | 404 | User not found |

---

## 8. データ整合性

### 8.1 関連データの扱い

| 関連テーブル | 処理 |
|-------------|------|
| todos.assignee_id | 削除ユーザーが担当のToDoは assignee_id を NULL に更新 |

### 8.2 処理順序

1. 先に todos テーブルの assignee_id を NULL に更新
2. その後 users テーブルからレコードを削除

これにより外部キー制約違反を防ぐ。

---

## 9. 関連項目

| 種別 | ID | 名称 |
|------|-----|------|
| API | [API-USER-002](API-USER-002.md) | ユーザー単一取得 |
| ロジック | UserService.delete | 削除ロジック |
| Mapper | UserMapper.findById | 存在チェック |
| Mapper | UserMapper.deleteById | DB削除 |
| Mapper | TodoMapper.clearAssigneeByUserId | 担当者クリア |

---

## 更新履歴

| 日付 | 変更内容 | 関連案件 |
|------|----------|----------|
| 2025-12-23 | 初版作成 | - |
