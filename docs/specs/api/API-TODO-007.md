# API-TODO-007: Todo完了切替

> **ドキュメント種別**: 最新仕様（継続的にメンテナンス）

## 1. 基本情報

| 項目 | 内容 |
|------|------|
| API ID | API-TODO-007 |
| メソッド | PATCH |
| パス | /api/todos/{id}/toggle |
| 機能 | 完了状態を反転（toggle） |
| 認証 | 不要 |

---

## 2. 利用案件

| 案件 | 日付 | 変更内容 |
|------|------|----------|
| 20251201_初期構築 | 2025-12-01 | 新規作成 |

---

## 3. 参照システム

### 3.1 画面

| 画面ID | 画面名 | 利用イベント | 用途 |
|--------|--------|-------------|------|
| SC-002 | ToDoリスト画面 | EV-002-05 完了状態切替 | チェックボックス操作 |

### 3.2 外部システム

| システム | 用途 |
|---------|------|
| - | 現在なし |

---

## 4. リクエスト

### 4.1 パスパラメータ

| パラメータ | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| id | Long | 必須 | ToDoのID |

### 4.2 クエリパラメータ

なし

### 4.3 リクエストボディ

なし

---

## 5. レスポンス

### 5.1 ステータスコード

| コード | 条件 |
|--------|------|
| 200 | 切替成功 |
| 404 | 指定IDが存在しない |

### 5.2 レスポンスボディ（成功時）

```json
{
  "id": 1,
  "title": "タスク名",
  "description": "説明",
  "completed": true,
  "createdAt": "2025-12-22T10:00:00",
  "assigneeId": 1,
  "assigneeName": "山田太郎"
}
```

---

## 6. 処理フロー

```
1. リクエスト受信（パスパラメータ id 取得）
   │
2. TodoMapper.findById(id) で存在確認
   │  └─ 存在しない → 404エラー
   │
3. completed フラグを反転
   │  ├─ true → false
   │  └─ false → true
   │
4. TodoMapper.update(todo) 呼び出し
   │
5. レスポンス返却（200 + 更新後のTodo）
```

---

## 7. エラー処理

| ケース | HTTPステータス | エラーメッセージ |
|--------|---------------|-----------------|
| 指定IDが存在しない | 404 | Todo not found |

---

## 8. 関連項目

| 種別 | ID | 名称 |
|------|-----|------|
| API | [API-TODO-006](API-TODO-006.md) | 更新（全項目） |
| ロジック | TodoService.toggleComplete | 完了切替ロジック |
| Mapper | TodoMapper.findById | 存在チェック |
| Mapper | TodoMapper.update | DB更新 |
| 画面 | [SC-002](../screens/SC-002/screen.md) | ToDoリスト画面 |
| イベント | [EV-002-05](../screens/SC-002/EV-002-05.md) | 完了状態切替 |

---

## 更新履歴

| 日付 | 変更内容 | 関連案件 |
|------|----------|----------|
| 2025-12-23 | 初版作成 | - |
