# バックエンドテストカタログ

> **ドキュメント種別**: 最新仕様（継続的にメンテナンス）

## 1. 概要

| 項目 | 内容 |
|------|------|
| テストフレームワーク | JUnit 5 + AssertJ |
| APIテストユーティリティ | Spring MockMvc（コントローラ/APIテストに使用） |
| Mapperテスト | @MybatisTest |
| 統合テスト | @SpringBootTest |
| 最終更新日 | 2025-12-23 |

---

## 2. テストケース統計

### 2.1 サマリー

| 対象クラス | 正常系 | 異常系 | 境界値 | 合計 |
|-----------|--------|--------|--------|------|
| TodoMapper | 13 | 1 | 1 | 15 |
| TodoService | 29 | 3 | 11 | 43 |
| TodoController | 25 | 5 | 0 | 30 |
| UserMapper | 7 | 1 | 1 | 9 |
| UserService | 5 | 2 | 0 | 7 |
| UserController | 8 | 6 | 0 | 14 |
| ProjectService | 11 | 2 | 5 | 18 |
| ProjectController | 11 | 4 | 0 | 15 |
| **合計** | **109** | **24** | **18** | **151** |

---

## 3. TodoMapper テストケース

> **ファイル**: `src/test/java/com/example/demo/TodoMapperTest.java`

### 3.1 selectAll()

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| M-001 | 全件取得（ソート確認） | 正常系 | 作成日時順で全件返却 |

### 3.2 selectById()

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| M-002 | 存在するIDで取得 | 正常系 | 該当Todoが返却 |
| M-003 | 存在しないIDで取得 | 異常系 | nullが返却 |

### 3.3 selectByCompleted()

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| M-004 | completed=trueで完了のみ取得 | 正常系 | 完了済みのみ返却 |
| M-005 | completed=falseで未完了のみ取得 | 正常系 | 未完了のみ返却 |

### 3.4 insert()

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| M-006 | 新規登録（ID自動採番） | 正常系 | IDが自動設定 |
| M-007 | description=nullで正常に挿入 | 正常系 | 正常に挿入 |

### 3.5 update()

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| M-008 | 既存Todoを更新 | 正常系 | 各フィールドが更新 |
| M-009 | 存在しないIDで更新（影響なし） | 正常系 | エラーなく完了 |

### 3.6 deleteById()

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| M-010 | 存在するIDを削除 | 正常系 | 件数減少 |
| M-011 | 存在しないIDで削除（影響なし） | 正常系 | 件数変化なし |

### 3.7 deleteAll()

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| M-012 | 全件削除 | 正常系 | 0件になる |

### 3.8 count()

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| M-013 | 件数取得 | 正常系 | 正確な件数が返却 |

### 3.9 countByCompleted()

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| M-014 | 完了件数取得 | 正常系 | 完了件数が返却 |
| M-015 | 未完了件数取得 | 正常系 | 未完了件数が返却 |

### 3.10 担当者関連

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| TC-M10 | 担当者名が取得できる | 正常系 | assigneeNameが返却 |
| TC-M11 | 担当者未設定でnull | 正常系 | assigneeName=null |
| TC-M12 | 担当者ID付き登録 | 正常系 | 正常に登録 |
| TC-M13 | 担当者変更 | 正常系 | 新担当者に更新 |
| TC-M13b | 担当者解除 | 境界値 | assigneeId=null |

---

## 4. TodoService テストケース

> **ファイル**: `src/test/java/com/example/demo/TodoServiceTest.java`

### 4.1 getAllTodos()

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| GT-001 | 初期状態で取得 | 正常系 | 3件が作成日時順で返却 |
| GT-002 | 全削除後に取得 | 境界値 | 空のリストが返却 |
| GT-003 | 新規追加後に取得 | 正常系 | 4件が作成日時順で返却 |

### 4.2 getTodosByCompleted()

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| GC-001 | completed=falseでフィルタ | 正常系 | 未完了のToDoのみ返却 |
| GC-002 | completed=trueでフィルタ | 正常系 | 完了済みのToDoのみ返却 |
| GC-003 | 該当なしの場合 | 境界値 | 空のリストが返却 |
| GC-004 | 結果が作成日時順でソート | 正常系 | ソート順が正しい |

### 4.3 getTodoById()

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| GI-001 | 存在するIDで取得 | 正常系 | 該当のTodoが返却 |
| GI-002 | 存在しないIDで取得 | 異常系 | nullが返却 |

### 4.4 createTodo()

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| CT-001 | 正常なToDoを作成 | 正常系 | IDが自動採番され返却 |
| CT-002 | 連続作成時のID採番 | 正常系 | IDが連番 |

### 4.5 updateTodo()

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| UT-001 | 存在するToDoを更新 | 正常系 | 更新されたTodoが返却 |
| UT-002 | 全フィールドを更新 | 正常系 | 全フィールドが正しく更新 |
| UT-003 | 存在しないIDで更新 | 異常系 | nullが返却 |
| UT-004 | createdAtが保持される | 境界値 | createdAtは元の値を維持 |

### 4.6 toggleComplete()

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| TC-001 | 未完了→完了に切り替え | 正常系 | completed=true |
| TC-002 | 完了→未完了に切り替え | 正常系 | completed=false |
| TC-003 | 存在しないIDで切り替え | 異常系 | nullが返却 |
| TC-004 | 2回連続切り替え | 境界値 | 元の状態に戻る |

### 4.7 deleteTodo()

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| DT-001 | 存在するToDoを削除 | 正常系 | 削除されたTodoが返却 |
| DT-002 | 存在しないIDで削除 | 正常系 | nullが返却 |
| DT-003 | 削除後に同じIDで取得 | 正常系 | nullが返却 |

### 4.8 deleteAllTodos()

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| DA-001 | 全ToDoを削除 | 正常系 | 総数が0 |
| DA-002 | 空の状態で全削除 | 境界値 | エラーなく完了 |

### 4.9 getTotalCount() / getCompletedCount() / getPendingCount()

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| CN-001 | 初期状態で取得 | 正常系 | 3が返却 |
| CN-002 | 追加後に取得 | 正常系 | 4が返却 |
| CN-003 | 削除後に取得 | 正常系 | 2が返却 |
| CN-004 | 全削除後に取得 | 境界値 | 0が返却 |
| CC-001 | 初期状態（全て未完了） | 正常系 | 0が返却 |
| CC-002 | 1件完了後 | 正常系 | 1が返却 |
| CC-003 | 全件完了後 | 正常系 | 3が返却 |
| CC-004 | 全削除後 | 境界値 | 0が返却 |
| PC-001 | 初期状態（全て未完了） | 正常系 | 3が返却 |
| PC-002 | 1件完了後 | 正常系 | 2が返却 |
| PC-003 | 全件完了後 | 境界値 | 0が返却 |
| PC-004 | 計算結果の検証 | 正常系 | total - completedと一致 |

### 4.10 getTodosByProjectId()

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| TC-TS-001 | 案件IDで該当チケット取得 | 正常系 | 該当案件のみ返却 |
| TC-TS-002 | 案件ID=nullで未分類取得 | 正常系 | 未分類のみ返却 |
| TC-TS-003 | 存在しない案件IDで空リスト | 正常系 | 空リスト返却 |

### 4.11 日付バリデーション

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| TC-TS-004 | 開始日=終了日でバリデーション通過 | 正常系 | 正常に作成 |
| TC-TS-005 | 開始日<終了日でバリデーション通過 | 正常系 | 正常に作成 |
| TC-TS-006 | 開始日>終了日でエラー | 境界値 | IllegalArgumentException |
| TC-TS-007 | 開始日のみ設定 | 正常系 | 正常に作成 |
| TC-TS-008 | 終了日のみ設定 | 正常系 | 正常に作成 |
| TC-TS-009 | 両方nullで通過 | 境界値 | 正常に作成 |

### 4.12 日付付き作成・更新

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| TC-TS-010 | 開始日・終了日を設定して作成 | 正常系 | 日付が正しく保存 |
| TC-TS-011 | 案件IDを設定して作成 | 正常系 | 案件が紐づく |
| TC-TS-012 | 日付フィールドを更新 | 正常系 | 日付が更新 |
| TC-TS-013 | 案件IDを更新 | 正常系 | 案件が変更 |
| TC-TS-014 | 更新時に不正な日付範囲 | 境界値 | IllegalArgumentException |

---

## 5. TodoController テストケース

> **ファイル**: `src/test/java/com/example/demo/TodoControllerTest.java`

### 5.1 GET /api/todos

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| A-001 | 全件取得 | 正常系 | 200 OK、JSON配列 |
| A-002 | completed=trueでフィルタ | 正常系 | 200 OK、完了のみ |
| A-003 | completed=falseでフィルタ | 正常系 | 200 OK、未完了のみ |

### 5.2 GET /api/todos/{id}

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| A-004 | 存在するID | 正常系 | 200 OK、該当Todo |
| A-005 | 存在しないID | 異常系 | 404 Not Found |

### 5.3 POST /api/todos

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| A-006 | 正常な新規作成 | 正常系 | 201 Created |
| A-007 | title空で作成 | 異常系 | 400 Bad Request |
| A-007b | title nullで作成 | 異常系 | 400 Bad Request |

### 5.4 PUT /api/todos/{id}

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| A-008 | 正常更新 | 正常系 | 200 OK |
| A-009 | 存在しないIDで更新 | 異常系 | 404 Not Found |

### 5.5 PATCH /api/todos/{id}/toggle

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| A-010 | 完了切替（2回連続） | 正常系 | 200 OK、状態トグル |
| A-011 | 存在しないIDで切替 | 異常系 | 404 Not Found |

### 5.6 DELETE /api/todos/{id}

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| A-012 | 正常削除 | 正常系 | 204 No Content |
| A-013 | 存在しないIDで削除 | 正常系 | 404 Not Found |

### 5.7 DELETE /api/todos

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| A-014 | 全件削除 | 正常系 | 204 No Content |

### 5.8 GET /api/todos/stats

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| A-015 | 統計取得 | 正常系 | 200 OK、total/completed/pending |

### 5.9 案件フィルタ

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| IT-TC-001 | projectIdで案件別取得 | 正常系 | 該当案件のみ返却 |
| IT-TC-002 | projectId=noneで未分類取得 | 正常系 | 未分類のみ返却 |
| IT-TC-003 | 存在しない案件IDで空配列 | 正常系 | 空配列返却 |

### 5.10 日付バリデーション（API）

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| IT-TC-004 | dueDate < startDateで400 | 異常系 | 400 Bad Request |
| IT-TC-005 | 正常な日付範囲で201 | 正常系 | 201 Created |

### 5.11 担当者関連

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| IT-20 | 担当者付きで作成 | 正常系 | 201 Created、assigneeName含む |
| IT-21 | 担当者なしで作成 | 正常系 | 201 Created |
| IT-22 | 存在しない担当者IDで400 | 異常系 | 400 Bad Request |
| IT-23 | 担当者変更 | 正常系 | 200 OK、新assigneeName |
| IT-24 | 担当者解除 | 正常系 | 200 OK、assigneeId=null |
| IT-25 | 一覧に担当者名含む | 正常系 | assigneeName含む |

### 5.12 後方互換性テスト

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| IT-30 | 既存形式で作成 | 正常系 | 201 Created |
| IT-31 | 既存の完了切替 | 正常系 | 200 OK |
| IT-32 | 既存の削除 | 正常系 | 204 No Content |

---

## 6. UserMapper テストケース

> **ファイル**: `src/test/java/com/example/demo/UserMapperTest.java`

### 6.1 selectAll()

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| TC-M01 | データありで全ユーザー取得 | 正常系 | 作成日時順で返却 |
| TC-M02 | データなしで空リスト | 正常系 | 空リスト返却 |

### 6.2 selectById()

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| TC-M03 | 存在するIDで取得 | 正常系 | 該当User返却 |
| TC-M04 | 存在しないIDで取得 | 異常系 | null返却 |

### 6.3 selectByName()

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| TC-M05 | 存在する名前で取得 | 正常系 | 該当User返却 |
| TC-M05b | 存在しない名前で取得 | 正常系 | null返却 |

### 6.4 insert()

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| TC-M06 | 正常なユーザー挿入 | 正常系 | ID自動採番 |

### 6.5 deleteById()

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| TC-M07 | 既存ユーザー削除 | 正常系 | 削除成功 |
| TC-M07b | 存在しないIDで削除 | 正常系 | 影響なし |

### 6.6 count()

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| TC-M07c | 件数取得 | 正常系 | 正確な件数 |

---

## 7. UserService テストケース

> **ファイル**: `src/test/java/com/example/demo/UserServiceTest.java`

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| TC-S01 | 全ユーザー一覧取得 | 正常系 | 初期データ含む |
| TC-S02 | 存在するIDでユーザー取得 | 正常系 | 該当User返却 |
| TC-S02b | 存在しないIDでnull | 異常系 | null返却 |
| TC-S03 | ユーザー正常作成 | 正常系 | ID付与、createdAt設定 |
| TC-S04 | 存在するユーザー名でtrue | 正常系 | true返却 |
| TC-S05 | 存在しないユーザー名でfalse | 正常系 | false返却 |
| TC-S06 | 存在するユーザー削除 | 正常系 | 削除成功 |
| TC-S07 | 存在しないIDで削除 | 異常系 | null返却 |

---

## 8. UserController テストケース

> **ファイル**: `src/test/java/com/example/demo/UserControllerTest.java`

### 8.1 GET /api/users

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| IT-01 | ユーザー一覧取得 | 正常系 | 200 OK、3件以上 |

### 8.2 GET /api/users/{id}

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| IT-02 | 存在するIDで取得 | 正常系 | 200 OK |
| IT-03 | 存在しないIDで404 | 異常系 | 404 Not Found |

### 8.3 POST /api/users

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| IT-04 | 正常なユーザー作成 | 正常系 | 201 Created |
| IT-05 | 名前が空で400 | 異常系 | 400 Bad Request |
| IT-05b | 名前がnullで400 | 異常系 | 400 Bad Request |
| IT-05c | 名前が空白のみで400 | 異常系 | 400 Bad Request |
| IT-06 | 重複名前で409 | 異常系 | 409 Conflict |
| IT-07 | 100文字の名前で登録 | 正常系 | 201 Created |
| IT-08 | 101文字の名前で400 | 異常系 | 400 Bad Request |

### 8.4 DELETE /api/users/{id}

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| IT-09 | ユーザー削除 | 正常系 | 204 No Content |
| IT-10 | 存在しないIDで404 | 異常系 | 404 Not Found |
| IT-11 | 削除時に担当解除 | 正常系 | ToDoのassigneeId=null |

---

## 9. ProjectService テストケース

> **ファイル**: `src/test/java/com/example/demo/ProjectServiceTest.java`

### 9.1 getAllProjects()

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| TC-PS-001 | 登録済み案件を作成日時降順で取得 | 正常系 | 降順で返却 |
| TC-PS-002 | 案件0件で空リスト | 境界値 | 空リスト返却 |

### 9.2 getProjectById()

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| TC-PS-003 | 存在するIDで案件取得 | 正常系 | 該当Project返却 |
| TC-PS-004 | 存在しないIDでnull | 異常系 | null返却 |

### 9.3 createProject()

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| TC-PS-005 | 正常な案件作成 | 正常系 | ID付与、createdAt設定 |
| TC-PS-006 | descriptionがnullで作成 | 正常系 | 正常に作成 |

### 9.4 updateProject()

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| TC-PS-007 | 存在する案件を更新 | 正常系 | 更新成功 |
| TC-PS-008 | 存在しないIDでnull | 異常系 | null返却 |

### 9.5 deleteProject()

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| TC-PS-009 | 配下チケットなしの案件削除 | 正常系 | 削除成功 |
| TC-PS-010 | 案件削除時にカスケード削除 | 正常系 | 配下チケットも削除 |
| TC-PS-011 | 存在しないIDでnull | 正常系 | null返却 |

### 9.6 getProjectStats()

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| TC-PS-012 | 全て未完了の場合の統計 | 正常系 | progressRate=0 |
| TC-PS-013 | 一部完了の場合の統計・進捗率 | 正常系 | 正しい進捗率 |
| TC-PS-014 | 全て完了の場合の進捗率100% | 正常系 | progressRate=100 |
| TC-PS-015 | チケット0件の場合の進捗率0% | 境界値 | progressRate=0 |
| TC-PS-016 | 進捗率が小数点以下切り捨て | 境界値 | 切り捨て値 |

---

## 10. ProjectController テストケース

> **ファイル**: `src/test/java/com/example/demo/ProjectControllerTest.java`

### 10.1 GET /api/projects

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| IT-PC-001 | 全案件取得 | 正常系 | 200 OK |
| IT-PC-002 | 案件0件で空配列 | 正常系 | 200 OK、空配列 |

### 10.2 GET /api/projects/{id}

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| IT-PC-003 | 存在するIDで取得 | 正常系 | 200 OK |
| IT-PC-004 | 存在しないIDで404 | 異常系 | 404 Not Found |

### 10.3 POST /api/projects

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| IT-PC-005 | 正常作成 | 正常系 | 201 Created |
| IT-PC-005b | name空で400 | 異常系 | 400 Bad Request |
| IT-PC-005c | name nullで400 | 異常系 | 400 Bad Request |

### 10.4 PUT /api/projects/{id}

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| IT-PC-006 | 正常更新 | 正常系 | 200 OK |
| IT-PC-006b | 存在しないIDで404 | 異常系 | 404 Not Found |

### 10.5 DELETE /api/projects/{id}

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| IT-PC-007 | 正常削除 | 正常系 | 204 No Content |
| IT-PC-007b | 存在しないIDで404 | 正常系 | 404 Not Found |
| IT-PC-007c | 配下チケットありでカスケード削除 | 正常系 | 配下チケットも削除 |

### 10.6 GET /api/projects/{id}/stats

| ID | テストケース | 分類 | 期待結果 |
|----|-------------|------|----------|
| IT-PC-008 | 統計取得 | 正常系 | 200 OK |
| IT-PC-008b | チケット0件で統計取得 | 正常系 | 0値の統計 |
| IT-PC-008c | 存在しない案件IDで404 | 異常系 | 404 Not Found |

---

## 11. テスト実行方法

```bash
# 全テスト実行
./mvnw test

# 特定クラスのテスト実行
./mvnw test -Dtest=TodoMapperTest
./mvnw test -Dtest=TodoServiceTest
./mvnw test -Dtest=TodoControllerTest
./mvnw test -Dtest=UserMapperTest
./mvnw test -Dtest=UserServiceTest
./mvnw test -Dtest=UserControllerTest
./mvnw test -Dtest=ProjectServiceTest
./mvnw test -Dtest=ProjectControllerTest

# 特定メソッドのテスト実行
./mvnw test -Dtest=TodoServiceTest#getAllTodos*
```

---

## 12. テスト設定

### 12.1 テストプロファイル

| 設定ファイル | 用途 |
|-------------|------|
| application-test.properties | テスト用H2インメモリDB設定 |

### 12.2 テストアノテーション

| アノテーション | 用途 | 適用クラス |
|--------------|------|-----------|
| @MybatisTest | Mapper単体テスト | TodoMapperTest, UserMapperTest |
| @SpringBootTest | 統合テスト | TodoServiceTest, UserServiceTest, ProjectServiceTest |
| @SpringBootTest + @AutoConfigureMockMvc | APIテスト | TodoControllerTest, UserControllerTest, ProjectControllerTest |
| @ActiveProfiles("test") | テストプロファイル有効化 | 全テストクラス |
| @Transactional | テスト後ロールバック | 全テストクラス |

---

## 更新履歴

| 日付 | 変更内容 |
|------|----------|
| 2025-12-23 | 初版作成（実装済みテストファイルから自動生成） |
