import{f as B,d as h,g as A,b as i,a as s,h as D,v as b,i as E,j as M,F as j,k as V,o as a,t as c,_ as y,l as f,n as $,m as _,c as k,p as w,q as N,s as q,u as R,x as K,e as I,w as z,r as J}from"./index-DBKnUi_6.js";import{d as G,p as H,a as O,g as Q,E as W,L as X}from"./ErrorMessage-h6aG8_qh.js";import{u as Y}from"./userStore-CpLz27gy.js";import{g as Z}from"./projectService-ESX1TuG6.js";async function tt(t){let n="/todos";return t&&(n+=`?projectId=${encodeURIComponent(t)}`),Q(n)}async function et(t){return O("/todos",t)}async function ot(t){return H(`/todos/${t}/toggle`)}async function st(t){return G(`/todos/${t}`)}const nt=B("todo",{state:()=>({todos:[],loading:!1,error:null,filter:"all",currentProjectId:null}),getters:{filteredTodos:t=>{switch(t.filter){case"pending":return t.todos.filter(n=>!n.completed);case"completed":return t.todos.filter(n=>n.completed);default:return t.todos}},stats:t=>{const n=t.todos.length,o=t.todos.filter(u=>u.completed).length;return{total:n,completed:o,pending:n-o}}},actions:{async fetchTodos(t){this.loading=!0,this.error=null,this.currentProjectId=t??null;try{this.todos=await tt(t)}catch(n){throw this.error="ToDoリストの読み込みに失敗しました",n}finally{this.loading=!1}},async addTodo(t){this.error=null;try{await et(t),await this.fetchTodos(this.currentProjectId)}catch(n){throw this.error="ToDoの追加に失敗しました",n}},async toggleTodo(t){this.error=null;try{await ot(t),await this.fetchTodos(this.currentProjectId)}catch(n){throw this.error="ToDoの更新に失敗しました",n}},async deleteTodo(t){this.error=null;try{await st(t),await this.fetchTodos(this.currentProjectId)}catch(n){throw this.error="ToDoの削除に失敗しました",n}},setFilter(t){this.filter=t},clearError(){this.error=null}}}),lt={class:"add-todo card"},at={class:"date-inputs"},dt={class:"date-field"},rt={class:"date-field"},it={class:"assignee-field"},ut=["value"],ct=h({__name:"TodoForm",props:{users:{},projectId:{}},emits:["submit"],setup(t,{emit:n}){const o=t,u=n,e=A({title:"",description:"",startDate:"",dueDate:"",assigneeId:""}),p=()=>e.title.trim()?e.startDate&&e.dueDate&&e.startDate>e.dueDate?(alert("終了日は開始日以降を指定してください"),!1):!0:(alert("タイトルを入力してください"),!1),T=()=>{e.title="",e.description="",e.startDate="",e.dueDate="",e.assigneeId=""},m=()=>{if(!p())return;const g={title:e.title.trim(),description:e.description.trim()||void 0,startDate:e.startDate||null,dueDate:e.dueDate||null,assigneeId:e.assigneeId?Number(e.assigneeId):null,projectId:o.projectId?Number(o.projectId):null};u("submit",g),T()};return(g,l)=>(a(),i("div",lt,[l[9]||(l[9]=s("h3",null,"新しいToDoを追加",-1)),D(s("input",{"onUpdate:modelValue":l[0]||(l[0]=d=>e.title=d),type:"text",placeholder:"タイトルを入力してください",onKeypress:E(m,["enter"])},null,544),[[b,e.title]]),D(s("textarea",{"onUpdate:modelValue":l[1]||(l[1]=d=>e.description=d),rows:"3",placeholder:"説明を入力してください（オプション）"},null,512),[[b,e.description]]),s("div",at,[s("div",dt,[l[5]||(l[5]=s("label",null,"開始日:",-1)),D(s("input",{"onUpdate:modelValue":l[2]||(l[2]=d=>e.startDate=d),type:"date"},null,512),[[b,e.startDate]])]),s("div",rt,[l[6]||(l[6]=s("label",null,"終了日:",-1)),D(s("input",{"onUpdate:modelValue":l[3]||(l[3]=d=>e.dueDate=d),type:"date"},null,512),[[b,e.dueDate]])])]),s("div",it,[l[8]||(l[8]=s("label",null,"担当者:",-1)),D(s("select",{"onUpdate:modelValue":l[4]||(l[4]=d=>e.assigneeId=d)},[l[7]||(l[7]=s("option",{value:""},"未割当",-1)),(a(!0),i(j,null,V(t.users,d=>(a(),i("option",{key:d.id,value:d.id},c(d.name),9,ut))),128))],512),[[M,e.assigneeId]])]),s("button",{class:"btn-primary",onClick:m},"追加")]))}}),mt=y(ct,[["__scopeId","data-v-87686a9d"]]),pt={key:0},gt={key:1,class:"date-range"},vt={class:"actions"},ft=h({__name:"TodoItem",props:{todo:{}},emits:["toggle","delete"],setup(t,{emit:n}){const o=t,u=n,e=f(()=>{if(!o.todo.startDate&&!o.todo.dueDate)return"";const m=o.todo.startDate||"未定",g=o.todo.dueDate||"未定";return`${m} 〜 ${g}`}),p=f(()=>new Date(o.todo.createdAt).toLocaleDateString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})),T=()=>{confirm("このToDoを削除しますか？")&&u("delete",o.todo.id)};return(m,g)=>(a(),i("div",{class:$(["todo-item card",{completed:t.todo.completed}])},[s("h3",null,c(t.todo.title),1),t.todo.description?(a(),i("p",pt,c(t.todo.description),1)):_("",!0),e.value?(a(),i("p",gt,"期間: "+c(e.value),1)):_("",!0),s("p",{class:$(["assignee",{unassigned:!t.todo.assigneeName}])}," 担当: "+c(t.todo.assigneeName||"未割当"),3),s("p",null,[s("small",null,"作成日: "+c(p.value),1)]),s("div",vt,[s("button",{class:"toggle-btn",onClick:g[0]||(g[0]=l=>m.$emit("toggle",t.todo.id))},c(t.todo.completed?"未完了にする":"完了にする"),1),s("button",{class:"delete-btn btn-danger",onClick:T},"削除")])],2))}}),ht=y(ft,[["__scopeId","data-v-14cbde54"]]),yt={class:"todo-list"},Tt={key:0,class:"empty-message"},Dt=h({__name:"TodoList",props:{todos:{}},emits:["toggle","delete"],setup(t){return(n,o)=>(a(),i("div",yt,[t.todos.length===0?(a(),i("p",Tt,"ToDoアイテムがありません。")):_("",!0),(a(!0),i(j,null,V(t.todos,u=>(a(),k(ht,{key:u.id,todo:u,onToggle:o[0]||(o[0]=e=>n.$emit("toggle",e)),onDelete:o[1]||(o[1]=e=>n.$emit("delete",e))},null,8,["todo"]))),128))]))}}),It=y(Dt,[["__scopeId","data-v-a0a63885"]]),bt={class:"stats card"},wt=h({__name:"TodoStats",props:{total:{},completed:{},pending:{}},setup(t){return(n,o)=>(a(),i("div",bt,[s("span",null,[o[0]||(o[0]=w("総数: ",-1)),s("strong",null,c(t.total),1)]),s("span",null,[o[1]||(o[1]=w("完了: ",-1)),s("strong",null,c(t.completed),1)]),s("span",null,[o[2]||(o[2]=w("未完了: ",-1)),s("strong",null,c(t.pending),1)])]))}}),$t=y(wt,[["__scopeId","data-v-d928c6ad"]]),_t={class:"filter-buttons"},kt=["onClick"],jt=h({__name:"TodoFilter",props:{modelValue:{}},emits:["update:modelValue"],setup(t){const n=[{value:"all",label:"すべて"},{value:"pending",label:"未完了"},{value:"completed",label:"完了済み"}];return(o,u)=>(a(),i("div",_t,[(a(),i(j,null,V(n,e=>s("button",{key:e.value,class:$({active:t.modelValue===e.value}),onClick:p=>o.$emit("update:modelValue",e.value)},c(e.label),11,kt)),64))]))}}),Vt=y(jt,[["__scopeId","data-v-31844975"]]),St={class:"container"},Ct={class:"project-subtitle"},Nt={class:"back-link"},xt=h({__name:"TodoView",setup(t){const n=R(),o=nt(),u=Y(),e=N(null),p=N("すべてのチケット"),T=f(()=>o.filteredTodos),m=f(()=>o.stats),g=f(()=>o.loading),l=f(()=>o.error),d=f(()=>u.users),S=f({get:()=>o.filter,set:r=>o.setFilter(r)}),C=async()=>{const r=e.value;if(!r)p.value="すべてのチケット";else if(r==="none")p.value="案件なし（未分類）";else try{const v=await Z(Number(r));p.value=v.name}catch{p.value="不明な案件"}},x=async r=>{try{await o.addTodo(r)}catch{}},F=async r=>{try{await o.toggleTodo(r)}catch{}},P=async r=>{try{await o.deleteTodo(r)}catch{}};return q(async()=>{e.value=n.query.projectId||null,await Promise.all([o.fetchTodos(e.value),u.fetchUsers(),C()])}),K(()=>n.query.projectId,async r=>{e.value=r||null,await Promise.all([o.fetchTodos(e.value),C()])}),(r,v)=>{const U=J("router-link");return a(),i("div",St,[v[2]||(v[2]=s("h1",null,"ToDoリスト",-1)),s("p",Ct,c(p.value),1),I($t,{total:m.value.total,completed:m.value.completed,pending:m.value.pending},null,8,["total","completed","pending"]),I(mt,{users:d.value,"project-id":e.value,onSubmit:x},null,8,["users","project-id"]),I(Vt,{modelValue:S.value,"onUpdate:modelValue":v[0]||(v[0]=L=>S.value=L)},null,8,["modelValue"]),I(W,{message:l.value},null,8,["message"]),g.value?(a(),k(X,{key:0})):(a(),k(It,{key:1,todos:T.value,onToggle:F,onDelete:P},null,8,["todos"])),s("div",Nt,[I(U,{to:"/projects"},{default:z(()=>[...v[1]||(v[1]=[w("← 案件一覧に戻る",-1)])]),_:1})])])}}}),Bt=y(xt,[["__scopeId","data-v-52445c00"]]);export{Bt as default};
