import{f as D,d as w,g as F,b as i,a as r,h as _,v as C,i as R,o as a,_ as g,n as A,m as P,t as j,y as E,l as h,s as I,e as f,c as N,F as T,k as z,p as v,w as V,r as L,z as M}from"./index-DBKnUi_6.js";import{a as K,b as U,d as q,c as G,e as H}from"./projectService-ESX1TuG6.js";import{E as J,L as O}from"./ErrorMessage-h6aG8_qh.js";const S={total:0,completed:0,progressRate:0},Q=D("project",{state:()=>({projects:[],loading:!1,error:null,projectStats:{},noProjectStats:{...S}}),actions:{async fetchProjects(){this.loading=!0,this.error=null;try{this.projects=await H(),await this.fetchAllStats()}catch(t){throw this.error="案件リストの読み込みに失敗しました",t}finally{this.loading=!1}},async createProject(t){this.error=null;try{await G(t),await this.fetchProjects()}catch(s){throw this.error="案件の作成に失敗しました",s}},async deleteProject(t){this.error=null;try{await q(t),await this.fetchProjects()}catch(s){throw this.error="案件の削除に失敗しました",s}},async fetchProjectStats(t){try{const s=await U(t);this.projectStats[t]=s}catch{this.projectStats[t]={...S}}},async fetchAllStats(){await Promise.all([...this.projects.map(t=>this.fetchProjectStats(t.id)),this.fetchNoProjectStats()])},async fetchNoProjectStats(){try{this.noProjectStats=await K()}catch{this.noProjectStats={...S}}},clearError(){this.error=null}}}),W={class:"add-form card"},X=w({__name:"ProjectForm",emits:["submit"],setup(t,{emit:s}){const o=s,e=F({name:"",description:""}),m=()=>{e.name="",e.description=""},l=()=>{if(!e.name.trim()){alert("案件名を入力してください");return}o("submit",{name:e.name.trim(),description:e.description.trim()||void 0}),m()};return(u,c)=>(a(),i("div",W,[c[2]||(c[2]=r("h3",null,"新しい案件を作成",-1)),_(r("input",{"onUpdate:modelValue":c[0]||(c[0]=p=>e.name=p),type:"text",placeholder:"案件名を入力してください",onKeypress:R(l,["enter"])},null,544),[[C,e.name]]),_(r("textarea",{"onUpdate:modelValue":c[1]||(c[1]=p=>e.description=p),rows:"2",placeholder:"説明を入力してください（オプション）"},null,512),[[C,e.description]]),r("button",{class:"btn-primary",onClick:l},"作成")]))}}),Y=g(X,[["__scopeId","data-v-02cf772a"]]),Z={key:0},tt={class:"stats-info"},et={key:1,class:"progress-bar"},st={class:"actions"},ot=w({__name:"ProjectCard",props:{project:{},stats:{},isNoProject:{type:Boolean}},emits:["view","delete"],setup(t,{emit:s}){const o=t,e=s,m=()=>{confirm("この案件を削除しますか？紐づいたチケットは未分類になります。")&&e("delete",o.project.id)};return(l,u)=>(a(),i("div",{class:A(["project-card card",{"no-project":t.isNoProject}])},[r("h3",null,j(t.project.name),1),t.project.description?(a(),i("p",Z,j(t.project.description),1)):P("",!0),r("p",tt," チケット: "+j(t.stats.total)+"件 / 完了: "+j(t.stats.completed)+"件 / 進捗: "+j(t.stats.progressRate)+"% ",1),t.isNoProject?P("",!0):(a(),i("div",et,[r("div",{class:"progress",style:E({width:t.stats.progressRate+"%"})},null,4)])),r("div",st,[r("button",{class:"view-btn btn-primary",onClick:u[0]||(u[0]=c=>l.$emit("view",t.project.id))},"チケット一覧"),t.isNoProject?P("",!0):(a(),i("button",{key:0,class:"delete-btn btn-danger",onClick:m},"削除"))])],2))}}),$=g(ot,[["__scopeId","data-v-0efb1fc9"]]),at={class:"container"},rt={key:1},nt={key:0,class:"empty-message"},ct={class:"back-link"},it=w({__name:"ProjectView",setup(t){const s=M(),o=Q(),e=h(()=>o.projects),m=h(()=>o.projectStats),l=h(()=>o.noProjectStats),u=h(()=>o.loading),c=h(()=>o.error),p={total:0,completed:0,progressRate:0},x=async d=>{try{await o.createProject(d)}catch{}},B=async d=>{try{await o.deleteProject(d)}catch{}},k=d=>{s.push({path:"/todos",query:{projectId:String(d)}})};return I(async()=>{await o.fetchProjects()}),(d,n)=>{const b=L("router-link");return a(),i("div",at,[n[4]||(n[4]=r("h1",null,"案件一覧",-1)),f(Y,{onSubmit:x}),f(J,{message:c.value},null,8,["message"]),u.value?(a(),N(O,{key:0})):(a(),i("div",rt,[e.value.length===0?(a(),i("p",nt,"案件がありません。")):P("",!0),(a(!0),i(T,null,z(e.value,y=>(a(),N($,{key:y.id,project:y,stats:m.value[y.id]||p,onView:k,onDelete:B},null,8,["project","stats"]))),128)),f($,{project:{id:"none",name:"案件なし（未分類）",description:"案件に紐づかないチケット",createdAt:""},stats:l.value,"is-no-project":!0,onView:n[0]||(n[0]=y=>k("none"))},null,8,["stats"])])),r("div",ct,[f(b,{to:"/users"},{default:V(()=>[...n[1]||(n[1]=[v("ユーザー管理",-1)])]),_:1}),n[3]||(n[3]=v(" | ",-1)),f(b,{to:"/"},{default:V(()=>[...n[2]||(n[2]=[v("← ホームに戻る",-1)])]),_:1})])])}}}),ut=g(it,[["__scopeId","data-v-ca7ef0fc"]]);export{ut as default};
